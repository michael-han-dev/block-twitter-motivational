"use strict";(()=>{var T=(o,e)=>()=>(o&&(e=o(o=0)),e);var O=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);async function i(o,e){try{return(await chrome.storage.sync.get({[o]:e}))[o]}catch{return e}}async function s(o,e){try{await chrome.storage.sync.set({[o]:e})}catch{}}var t,c,g=T(()=>{"use strict";t={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode",OPENROUTER_API_KEY:"openRouterApiKey",CUSTOM_PROMPT:"customPrompt"},c={[t.SLOP_BLOCK_ENABLED]:!1,[t.DETECTION_COUNT]:0,[t.USER_WHITELIST]:[],[t.BLUR_MODE]:!0,[t.OPENROUTER_API_KEY]:"",[t.CUSTOM_PROMPT]:""}});var b=O(()=>{g();chrome.runtime.onInstalled.addListener(async o=>{o.reason==="install"&&(await s(t.SLOP_BLOCK_ENABLED,c[t.SLOP_BLOCK_ENABLED]),await s(t.BLUR_MODE,c[t.BLUR_MODE]),await s(t.DETECTION_COUNT,c[t.DETECTION_COUNT]),await s(t.USER_WHITELIST,c[t.USER_WHITELIST]));let e=await i(t.SLOP_BLOCK_ENABLED,c[t.SLOP_BLOCK_ENABLED]);await u(e)});chrome.runtime.onMessage.addListener(async(o,e,a)=>{var n;try{switch(o.action){case"stateChanged":await u(o.enabled),a({success:!0});break;case"updateCount":let d=await i(t.DETECTION_COUNT,c[t.DETECTION_COUNT])+(o.count||1);await s(t.DETECTION_COUNT,d),(n=e.tab)!=null&&n.id&&await l(!0,e.tab.id,d),a({success:!0});break;default:a({error:"Unknown action"})}}catch(r){a({error:r instanceof Error?r.message:"Unknown error"})}return!0});async function u(o){try{let e=o?"Slop Block: ON (click to disable)":"Slop Block: OFF (click to enable)";await chrome.action.setTitle({title:e});let n=(await chrome.tabs.query({})).filter(r=>E(r.url));for(let r of n)r.id&&await l(o,r.id)}catch{}}async function l(o,e,a){try{if(!o){await chrome.action.setBadgeText({text:"",tabId:e});return}if(a!==void 0&&a>0){let n=a>99?"99+":a.toString();await chrome.action.setBadgeText({text:n,tabId:e}),await chrome.action.setBadgeBackgroundColor({color:"#ff4444",tabId:e})}else await chrome.action.setBadgeText({text:"ON",tabId:e}),await chrome.action.setBadgeBackgroundColor({color:"#00aa00",tabId:e})}catch{}}function E(o){return o?o.includes("twitter.com")||o.includes("x.com"):!1}chrome.tabs.onUpdated.addListener(async(o,e,a)=>{if(e.status==="complete"&&E(a.url)){let n=await i(t.SLOP_BLOCK_ENABLED,c[t.SLOP_BLOCK_ENABLED]);await l(n,o)}})});b();})();
