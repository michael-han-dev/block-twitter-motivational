"use strict";(()=>{var T=(e,o)=>()=>(e&&(o=e(e=0)),o);var m=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);async function c(e,o){try{return(await chrome.storage.sync.get({[e]:o}))[e]}catch(n){return console.error(`Failed to get storage value for key ${e}:`,n),o}}async function s(e,o){try{await chrome.storage.sync.set({[e]:o})}catch(n){console.error(`Failed to set storage value for key ${e}:`,n)}}var t,i,g=T(()=>{"use strict";t={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode",OPENROUTER_API_KEY:"openRouterApiKey",AI_DETECTION_ENABLED:"aiDetectionEnabled",SYSTEM_PROMPT:"systemPrompt",BATCH_SIZE:"batchSize",CUSTOM_PROMPT:"customPrompt",PROCESSED_TWEET_IDS:"processedTweetIds",LLM_ANALYZED_IDS:"llmAnalyzedIds",COLLAPSED_TWEET_IDS:"collapsedTweetIds"},i={[t.SLOP_BLOCK_ENABLED]:!1,[t.DETECTION_COUNT]:0,[t.USER_WHITELIST]:[],[t.BLUR_MODE]:!0,[t.OPENROUTER_API_KEY]:"",[t.AI_DETECTION_ENABLED]:!1,[t.SYSTEM_PROMPT]:`You are an expert at detecting AI-generated motivational slop, engagement bait, and generic inspirational content on social media. Analyze each tweet and classify it as slop or genuine content.

SLOP INDICATORS:
\u2022 Motivational clich\xE9s: "mindset is everything", "follow your dreams", "hustle harder", "grind never stops"
\u2022 Business/money schemes: "$10k/month", "passive income", "quit my job", "financial freedom"
\u2022 Generic advice patterns: "here's what I learned", "X things nobody tells you", "stop doing this, start doing this"
\u2022 Engagement bait: "unpopular opinion", "let that sink in", "read that again", "thread \u{1F9F5}"
\u2022 AI-like structure: numbered lists, formulaic advice, excessive emojis
\u2022 Buzzwords: entrepreneur, transformation, breakthrough, optimize, unlock potential
\u2022 Sales pitches: "DM me", "link in bio", "limited time", "exclusive access"

Return JSON format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]} where id matches tweet position (0-14).`,[t.BATCH_SIZE]:10,[t.CUSTOM_PROMPT]:"",[t.PROCESSED_TWEET_IDS]:[],[t.LLM_ANALYZED_IDS]:[],[t.COLLAPSED_TWEET_IDS]:[]}});var p=m(()=>{g();chrome.runtime.onInstalled.addListener(async e=>{console.log("Slop Block extension installed/updated:",e.reason),e.reason==="install"&&(await s(t.SLOP_BLOCK_ENABLED,i[t.SLOP_BLOCK_ENABLED]),await s(t.BLUR_MODE,i[t.BLUR_MODE]),await s(t.DETECTION_COUNT,i[t.DETECTION_COUNT]),await s(t.USER_WHITELIST,i[t.USER_WHITELIST]));let o=await c(t.SLOP_BLOCK_ENABLED,i[t.SLOP_BLOCK_ENABLED]);await u(o)});chrome.runtime.onMessage.addListener(async(e,o,n)=>{var r;console.log("\u{1F4E8} Background received message:",e);try{switch(e.action){case"stateChanged":console.log("\u{1F504} Processing state change:",e.enabled),await u(e.enabled),console.log("\u2705 Icon updated for state change"),n({success:!0});break;case"updateCount":console.log("\u{1F4CA} Processing count update:",e.count);let a=await c(t.DETECTION_COUNT,i[t.DETECTION_COUNT]),l=a+(e.count||1);await s(t.DETECTION_COUNT,l),console.log("\u{1F4C8} Count updated:",a,"\u2192",l),(r=o.tab)!=null&&r.id&&(console.log("\u{1F3F7}\uFE0F Updating badge for tab:",o.tab.id),await d(!0,o.tab.id,l)),n({success:!0});break;default:console.warn("\u26A0\uFE0F Unknown message action:",e.action),n({error:"Unknown action"})}}catch(a){console.error("\u274C Error handling message:",a),n({error:a instanceof Error?a.message:"Unknown error"})}return!0});async function u(e){try{console.log("\u{1F3AF} Updating icon for enabled state:",e);let o=e?"Slop Block: ON (click to disable)":"Slop Block: OFF (click to enable)";await chrome.action.setTitle({title:o}),console.log("\u{1F4DD} Title updated:",o);let r=(await chrome.tabs.query({})).filter(a=>E(a.url));console.log("\u{1F426} Found Twitter tabs:",r.length);for(let a of r)a.id&&(console.log("\u{1F3F7}\uFE0F Updating badge for Twitter tab:",a.id,a.url),await d(e,a.id));console.log(`\u2705 Icon updated: ${e?"enabled":"disabled"}`)}catch(o){console.error("\u274C Failed to update icon:",o)}}async function d(e,o,n){try{if(console.log("\u{1F3F7}\uFE0F Updating badge:",{enabled:e,tabId:o,count:n}),!e){console.log("\u{1F6AB} Extension disabled - clearing badge"),await chrome.action.setBadgeText({text:"",tabId:o});return}if(n!==void 0&&n>0){let r=n>99?"99+":n.toString();console.log("\u{1F522} Setting count badge:",r),await chrome.action.setBadgeText({text:r,tabId:o}),await chrome.action.setBadgeBackgroundColor({color:"#ff4444",tabId:o})}else console.log("\u2705 Setting ON badge"),await chrome.action.setBadgeText({text:"ON",tabId:o}),await chrome.action.setBadgeBackgroundColor({color:"#00aa00",tabId:o});console.log("\u2705 Badge update completed")}catch(r){console.error("\u274C Failed to update badge:",r)}}function E(e){return e?e.includes("twitter.com")||e.includes("x.com"):!1}chrome.tabs.onUpdated.addListener(async(e,o,n)=>{if(o.status==="complete"&&E(n.url)){let r=await c(t.SLOP_BLOCK_ENABLED,i[t.SLOP_BLOCK_ENABLED]);await d(r,e)}});console.log("Slop Block background service worker loaded")});p();})();
