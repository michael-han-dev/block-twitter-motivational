"use strict";(()=>{var T=!1;function O(e){T=e}function D(e){let o=[];return e.querySelectorAll('[data-testid="tweet"]').forEach(n=>{let s=z(n);s&&o.push(s)}),o}function W(e){if(!T)return;console.log("=== TWEET DOM ANALYSIS ==="),console.log("Main element:",e),console.log("innerHTML preview:",e.innerHTML.substring(0,300)),['[data-testid="tweetText"]',".css-1jxf684",".css-1qaijid","[lang]",'span[dir="auto"]',"div[lang]",'span:not([class*="icon"]):not([aria-hidden="true"])'].forEach(n=>{var r;let s=e.querySelector(n);(r=s==null?void 0:s.textContent)!=null&&r.trim()?console.log(`\u2713 Selector "${n}":`,s.textContent.substring(0,100)):console.log(`\u2717 Selector "${n}": no content`)});let t=B(e);console.log(`Found ${t.length} text nodes`),t.slice(0,3).forEach((n,s)=>{var r;console.log(`Text node ${s}:`,(r=n.textContent)==null?void 0:r.substring(0,100))})}function z(e){var o;try{W(e);let t=V(e);T&&(console.log("Extracted text length:",t.length),console.log("Extracted text preview:",t.substring(0,150)));let n=v(e,"like"),s=v(e,"retweet"),r=v(e,"reply"),d=!!e.querySelector('[data-testid="icon-verified"]'),c=e.querySelector('[data-testid="User-Name"] a'),m=((o=c==null?void 0:c.textContent)==null?void 0:o.replace("@",""))||"";return{element:e,textContent:t,metadata:{likes:n,retweets:s,replies:r,isVerified:d,username:m}}}catch(t){return console.warn("Failed to extract tweet data:",t),null}}function V(e){var d,c,m,S;let o=e.querySelector('[data-testid="tweetText"]');if((d=o==null?void 0:o.textContent)!=null&&d.trim())return o.textContent.trim();let t=e.querySelectorAll("[lang]");for(let E of Array.from(t)){let a=(c=E.textContent)==null?void 0:c.trim();if(a&&a.length>20&&!a.includes("http")&&!a.includes("@"))return a}let n=[".css-1jxf684",".css-1qaijid",'span[dir="auto"]',"div[lang] span"];for(let E of n){let a=e.querySelector(E),L=(m=a==null?void 0:a.textContent)==null?void 0:m.trim();if(L&&L.length>10)return L}let s=B(e),r="";for(let E of s){let a=(S=E.textContent)==null?void 0:S.trim();a&&a.length>5&&!a.includes("\xB7")&&!a.match(/^\d+[mhs]$/)&&!a.includes("Show this thread")&&!a.includes("Replying to")&&(r+=a+" ")}return r.trim()}function B(e){let o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),t=[],n;for(;n=o.nextNode();){let s=n.parentElement;s&&(s.tagName==="SCRIPT"||s.tagName==="STYLE"||s.hasAttribute("aria-hidden")||s.style.display==="none"||t.push(n))}return t}function v(e,o){var t;try{let n="";switch(o){case"like":n='[data-testid="like"]';break;case"retweet":n='[data-testid="retweet"]';break;case"reply":n='[data-testid="reply"]';break}let s=e.querySelector(n),r=s==null?void 0:s.querySelector('[data-testid$="count"]'),d=((t=r==null?void 0:r.textContent)==null?void 0:t.trim())||"0";return K(d)}catch{return 0}}function K(e){if(!e||e==="0")return 0;let o=e.toLowerCase(),t=parseFloat(o);return o.includes("k")?Math.floor(t*1e3):o.includes("m")?Math.floor(t*1e6):Math.floor(t)||0}function $(e,o){e.classList.remove("slop-blurred","slop-hidden"),o==="blur"?e.classList.add("slop-blurred"):o==="hide"&&e.classList.add("slop-hidden")}function _(e){var d;if(e.querySelector(".slop-replacement"))return;let o=e.querySelector('[data-testid="tweetText"]'),t=o==null?void 0:o.parentElement;if(t||(t=(d=e.querySelector("[lang]"))==null?void 0:d.parentElement),t||(t=e.querySelector('[data-testid="tweet"]')||e),!t){console.warn("Could not find content container for tweet replacement");return}let n=document.createElement("div");n.className="slop-replacement",n.style.cssText=`
    padding: 16px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 12px;
    text-align: center;
    margin: 8px 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  `,n.innerHTML=`
    <div style="color: #6c757d; font-size: 14px; font-weight: 500; margin-bottom: 8px;">
      \u{1F916} AI-generated content hidden
    </div>
    <button class="slop-show-button" style="
      background: #007bff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    " onmouseover="this.style.backgroundColor='#0056b3'" onmouseout="this.style.backgroundColor='#007bff'">
      Show anyway
    </button>
  `;let s=t.innerHTML;n.querySelector(".slop-show-button").addEventListener("click",()=>{t.innerHTML=s,t.style.filter="blur(3px)",t.style.opacity="0.7";let c=document.createElement("button");c.textContent="Hide again",c.style.cssText=`
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      z-index: 1000;
    `,c.addEventListener("click",()=>{t.innerHTML="",t.appendChild(n),t.style.filter="",t.style.opacity=""}),t.style.position="relative",t.appendChild(c)}),t.innerHTML="",t.appendChild(n)}function x(e,o){if(!T)return;let t=e;t.classList.remove("slop-debug-processed","slop-debug-detected"),o?(t.classList.add("slop-debug-detected"),t.style.border="2px solid red",t.style.backgroundColor="rgba(255, 0, 0, 0.1)"):(t.classList.add("slop-debug-processed"),t.style.border="1px dashed green")}function M(e){e.classList.remove("slop-blurred","slop-hidden")}function A(e,o){let t;return function(...n){t||(e.apply(this,n),t=!0,setTimeout(()=>t=!1,o))}}function N(e,o){let t;return function(...n){clearTimeout(t),t=window.setTimeout(()=>e.apply(this,n),o)}}async function w(e,o){try{return(await chrome.storage.sync.get({[e]:o}))[e]}catch(t){return console.error(`Failed to get storage value for key ${e}:`,t),o}}var i={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode"},y={[i.SLOP_BLOCK_ENABLED]:!1,[i.DETECTION_COUNT]:0,[i.USER_WHITELIST]:[],[i.BLUR_MODE]:!0};var j=[/at first.*then.*but eventually/i,/first.*then.*finally/i,/started.*then.*now/i,/people buy from people who:/i,/want to \w+\? here's how/i,/you don't need:.*you need:/i,/here's what \w+ taught me:/i,/\d{3,}.*here's how/i,/\d{3,}.*here's the/i,/\$\d{1,3}k.*in \d+ days/i,/\d+\s*million.*here's/i,/volume wins on \w+/i,/the answer is more/i,/consistency beats perfection/i,/growth is simply.*\d+%.*\d+%/i,/success is \d+%.*\d+%/i,/went from \$?\d+.*to \$?\d+/i,/\d+\s*(downloads|users|followers)/i,/made \$\d+.*in \d+ months/i,/from zero to \$\d+/i,/stop \w+ing everything/i,/stop making excuses/i,/you're overthinking/i,/quit complaining/i,/you can be a \w+ & still:/i,/successful people don't:/i,/millionaires do this:/i,/your future self will thank you/i,/isn't coming to save you/i,/bet on yourself/i],R={maxEmojis:3,maxLineBreaks:6};function F(e,o){return Y(e,o).isSlop}function Y(e,o){let t=[],n=0;j.forEach((c,m)=>{c.test(e)&&(t.push(`Matched slop pattern ${m+1}`),n+=.4)});let s=(e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/gu)||[]).length,r=(e.match(/\n/g)||[]).length;return s>R.maxEmojis&&(t.push(`Too many emojis: ${s}`),n+=.3),r>R.maxLineBreaks&&(t.push(`Too many line breaks: ${r}`),n+=.3),e.toLowerCase().includes("ai generated")&&(t.push('Contains "AI generated" phrase'),n+=.8),e.toLowerCase().includes("as an ai")&&(t.push("Contains AI self-identification"),n+=.9),o.likes+o.retweets+o.replies===0&&e.length>200&&(t.push("Long tweet with no engagement"),n+=.3),n=Math.min(n,1),{isSlop:n>.3,confidence:n,reasons:t}}function P(e,o){if(!e||!o.length)return!1;let t=e.toLowerCase().replace("@","");return o.some(n=>n.toLowerCase()===t)}var p=null,l=!1,u=!0,C=!1,b=[],f=new Set;chrome.storage.onChanged.addListener(async(e,o)=>{if(console.log("\u{1F504} Storage change detected:",{area:o,changes:e}),o==="sync"){if(e[i.SLOP_BLOCK_ENABLED]){let t=e[i.SLOP_BLOCK_ENABLED].oldValue,n=e[i.SLOP_BLOCK_ENABLED].newValue;console.log(`\u{1F4F1} Toggle state change: ${t} \u2192 ${n}`),n!==l&&(l=n,console.log(`\u2705 Extension ${l?"ENABLED":"DISABLED"} via storage change`),l?(k(),g()):(I(),h()))}if(e[i.BLUR_MODE]){let t=e[i.BLUR_MODE].newValue;console.log(`\u{1F3A8} Blur mode change: ${u} \u2192 ${t}`),t!==u&&(u=t,l&&(h(),g()))}if(e[i.USER_WHITELIST]){let t=e[i.USER_WHITELIST].newValue;console.log("\u{1F4DD} Whitelist change:",t),b=t,l&&(h(),g())}}});async function U(){console.log("\u{1F680} Slop Block content script initializing...");try{console.log("\u{1F4D6} Reading initial storage values..."),l=await w(i.SLOP_BLOCK_ENABLED,y[i.SLOP_BLOCK_ENABLED]),u=await w(i.BLUR_MODE,y[i.BLUR_MODE]),b=await w(i.USER_WHITELIST,y[i.USER_WHITELIST]),console.log("\u{1F4CA} Initial state:",{isEnabled:l,blurMode:u,whitelistLength:b.length}),C=location.hostname==="localhost"||new URLSearchParams(location.search).has("slopDebug")||location.hash.includes("slopDebug"),O(C),console.log(`\u2705 Slop Block initialized: enabled=${l}, blurMode=${u}, debug=${C}`),l?(console.log("\u{1F440} Starting DOM observation..."),k()):console.log("\u{1F634} Extension disabled - skipping DOM observation"),console.log("\u{1F50D} Processing existing tweets..."),g()}catch(e){console.error("\u274C Failed to initialize Slop Block:",e)}}function k(){p&&p.disconnect(),p=new MutationObserver(A(e=>{if(!l){console.log("\u26A0\uFE0F Observer triggered but extension disabled");return}console.log(`\u{1F504} DOM mutations detected: ${e.length} changes`),e.forEach(o=>{o.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&q(t)})})},100)),p.observe(document.body,{childList:!0,subtree:!0}),console.log("\u{1F441}\uFE0F DOM observer started")}function I(){p&&(p.disconnect(),p=null),console.log("DOM observer stopped")}var g=N(()=>{if(!l){console.log("\u26A0\uFE0F processExistingTweets called but extension disabled");return}console.log("\u{1F50D} Processing existing tweets...");let e=performance.now();q(document.body);let o=performance.now();console.log(`\u23F1\uFE0F Tweet processing completed in ${(o-e).toFixed(2)}ms`)},200);function q(e){let o=D(e);console.log(`\u{1F426} Found ${o.length} tweet elements`),o.length===0&&(console.log("\u{1F4C4} No tweets found - checking selectors on current page"),['[data-testid="tweet"]','article[data-testid="tweet"]','[data-testid="tweetText"]'].forEach(n=>{let s=e.querySelectorAll(n);console.log(`\u{1F3AF} Selector "${n}": ${s.length} elements`)})),o.forEach((t,n)=>{console.log(`\u{1F504} Processing tweet ${n+1}/${o.length}`),G(t)})}function G(e){if(f.has(e.element)){console.log("\u23ED\uFE0F Tweet already processed, skipping");return}try{if(console.log("\u{1F4DD} Tweet details:",{textLength:e.textContent.length,textPreview:e.textContent.substring(0,50)+(e.textContent.length>50?"...":""),username:e.metadata.username,hasElement:!!e.element}),e.metadata.username&&P(e.metadata.username,b)){console.log(`\u2705 User "${e.metadata.username}" is whitelisted, skipping`),x(e.element,!1),f.add(e.element);return}console.log("\u{1F916} Running slop detection...");let o=F(e.textContent,e.metadata);console.log(`\u{1F3AF} Slop detection result: ${o?"SLOP DETECTED":"NOT SLOP"}`),o?(console.log("\u{1F6A8} SLOP DETECTED - Applying effects:",{text:e.textContent.substring(0,100)+"...",username:e.metadata.username,engagement:{likes:e.metadata.likes,retweets:e.metadata.retweets,replies:e.metadata.replies},blurMode:u}),u?(console.log("\u{1F32B}\uFE0F Applying blur effect"),$(e.element,"blur")):(console.log("\u{1F504} Replacing with hidden message"),_(e.element)),x(e.element,!0),chrome.runtime.sendMessage({action:"updateCount",count:1}).catch(t=>console.log("\u{1F4E1} Background script not ready:",t))):(console.log("\u2705 Tweet is not slop, removing any effects"),M(e.element),x(e.element,!1)),f.add(e.element),console.log(`\u{1F4CA} Total processed tweets: ${f.size}`)}catch(o){console.error("\u274C Error processing tweet:",o),console.error("\u{1F41B} Tweet data:",{element:e.element,text:e.textContent})}}function h(){f.forEach(e=>{M(e)}),f.clear(),console.log("All tweet effects cleared")}chrome.runtime.onMessage.addListener((e,o,t)=>{switch(console.log("Content script received message:",e),e.action){case"toggleSlop":l=e.enabled,console.log(`Slop Block ${l?"enabled":"disabled"}`),l?(k(),g()):(I(),h());break;case"updateSettings":e.blurMode!==void 0&&(u=e.blurMode,l&&(h(),g())),e.whitelist!==void 0&&(b=e.whitelist,l&&(h(),g()));break;default:console.warn("Unknown message action:",e.action)}return t({success:!0}),!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U):U();var H=location.href;new MutationObserver(()=>{location.href!==H&&(H=location.href,console.log("Page navigation detected, reinitializing..."),f.clear(),setTimeout(()=>{l&&g()},1e3))}).observe(document,{subtree:!0,childList:!0});console.log("Slop Block content script loaded");})();
