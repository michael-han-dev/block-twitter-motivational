"use strict";(()=>{function T(e){let o=[];return e.querySelectorAll('[data-testid="tweet"]').forEach(n=>{let r=A(n);r&&o.push(r)}),o}function A(e){var o,t;try{let n=e.querySelector('[data-testid="tweetText"]'),r=((o=n==null?void 0:n.textContent)==null?void 0:o.trim())||"",i=h(e,"like"),u=h(e,"retweet"),f=h(e,"reply"),p=!!e.querySelector('[data-testid="icon-verified"]'),g=e.querySelector('[data-testid="User-Name"] a'),U=((t=g==null?void 0:g.textContent)==null?void 0:t.replace("@",""))||"";return{element:e,textContent:r,metadata:{likes:i,retweets:u,replies:f,isVerified:p,username:U}}}catch(n){return console.warn("Failed to extract tweet data:",n),null}}function h(e,o){var t;try{let n="";switch(o){case"like":n='[data-testid="like"]';break;case"retweet":n='[data-testid="retweet"]';break;case"reply":n='[data-testid="reply"]';break}let r=e.querySelector(n),i=r==null?void 0:r.querySelector('[data-testid$="count"]'),u=((t=i==null?void 0:i.textContent)==null?void 0:t.trim())||"0";return B(u)}catch{return 0}}function B(e){if(!e||e==="0")return 0;let o=e.toLowerCase(),t=parseFloat(o);return o.includes("k")?Math.floor(t*1e3):o.includes("m")?Math.floor(t*1e6):Math.floor(t)||0}function y(e,o){e.classList.remove("slop-blurred","slop-hidden"),o==="blur"?e.classList.add("slop-blurred"):o==="hide"&&e.classList.add("slop-hidden")}function E(e){e.classList.remove("slop-blurred","slop-hidden")}function S(e,o){let t;return function(...n){t||(e.apply(this,n),t=!0,setTimeout(()=>t=!1,o))}}function v(e,o){let t;return function(...n){clearTimeout(t),t=window.setTimeout(()=>e.apply(this,n),o)}}async function x(e,o){try{return(await chrome.storage.sync.get({[e]:o}))[e]}catch(t){return console.error(`Failed to get storage value for key ${e}:`,t),o}}var a={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode"},L={[a.SLOP_BLOCK_ENABLED]:!1,[a.DETECTION_COUNT]:0,[a.USER_WHITELIST]:[],[a.BLUR_MODE]:!0};var R=[/at first.*then.*but eventually/i,/first.*then.*finally/i,/started.*then.*now/i,/people buy from people who:/i,/want to \w+\? here's how/i,/you don't need:.*you need:/i,/here's what \w+ taught me:/i,/\d{3,}.*here's how/i,/\d{3,}.*here's the/i,/\$\d{1,3}k.*in \d+ days/i,/\d+\s*million.*here's/i,/volume wins on \w+/i,/the answer is more/i,/consistency beats perfection/i,/growth is simply.*\d+%.*\d+%/i,/success is \d+%.*\d+%/i,/went from \$?\d+.*to \$?\d+/i,/\d+\s*(downloads|users|followers)/i,/made \$\d+.*in \d+ months/i,/from zero to \$\d+/i,/stop \w+ing everything/i,/stop making excuses/i,/you're overthinking/i,/quit complaining/i,/you can be a \w+ & still:/i,/successful people don't:/i,/millionaires do this:/i,/your future self will thank you/i,/isn't coming to save you/i,/bet on yourself/i],M={maxEmojis:3,maxLineBreaks:6};function k(e,o){return $(e,o).isSlop}function $(e,o){let t=[],n=0;R.forEach((f,p)=>{f.test(e)&&(t.push(`Matched slop pattern ${p+1}`),n+=.4)});let r=(e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/gu)||[]).length,i=(e.match(/\n/g)||[]).length;return r>M.maxEmojis&&(t.push(`Too many emojis: ${r}`),n+=.3),i>M.maxLineBreaks&&(t.push(`Too many line breaks: ${i}`),n+=.3),e.toLowerCase().includes("ai generated")&&(t.push('Contains "AI generated" phrase'),n+=.8),e.toLowerCase().includes("as an ai")&&(t.push("Contains AI self-identification"),n+=.9),o.likes+o.retweets+o.replies===0&&e.length>200&&(t.push("Long tweet with no engagement"),n+=.3),n=Math.min(n,1),{isSlop:n>.3,confidence:n,reasons:t}}function C(e,o){if(!e||!o.length)return!1;let t=e.toLowerCase().replace("@","");return o.some(n=>n.toLowerCase()===t)}var l=null,s=!1,m=!0,b=[],c=new Set;async function F(){console.log("Slop Block content script initializing...");try{let e=await chrome.runtime.sendMessage({action:"getState"});e&&(s=e.enabled,m=e.blurMode),b=await x(a.USER_WHITELIST,L[a.USER_WHITELIST]),console.log(`Slop Block initialized: enabled=${s}, blurMode=${m}`),s&&D(),d()}catch(e){console.error("Failed to initialize Slop Block:",e)}}function D(){l&&l.disconnect(),l=new MutationObserver(S(e=>{s&&e.forEach(o=>{o.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&_(t)})})},100)),l.observe(document.body,{childList:!0,subtree:!0}),console.log("DOM observer started")}function I(){l&&(l.disconnect(),l=null),console.log("DOM observer stopped")}var d=v(()=>{s&&(console.log("Processing existing tweets..."),_(document.body))},200);function _(e){T(e).forEach(t=>N(t))}function N(e){if(!c.has(e.element))try{if(e.metadata.username&&C(e.metadata.username,b)){c.add(e.element);return}if(k(e.textContent,e.metadata)){console.log("Slop detected:",{text:e.textContent.substring(0,100)+"...",username:e.metadata.username,engagement:{likes:e.metadata.likes,retweets:e.metadata.retweets,replies:e.metadata.replies}});let t=m?"blur":"hide";y(e.element,t),chrome.runtime.sendMessage({action:"updateCount",count:1})}else E(e.element);c.add(e.element)}catch(o){console.error("Error processing tweet:",o)}}function w(){c.forEach(e=>{E(e)}),c.clear(),console.log("All tweet effects cleared")}chrome.runtime.onMessage.addListener((e,o,t)=>{switch(console.log("Content script received message:",e),e.action){case"toggleSlop":s=e.enabled,console.log(`Slop Block ${s?"enabled":"disabled"}`),s?(D(),d()):(I(),w());break;case"updateSettings":e.blurMode!==void 0&&(m=e.blurMode,s&&(w(),d())),e.whitelist!==void 0&&(b=e.whitelist,s&&(w(),d()));break;default:console.warn("Unknown message action:",e.action)}t({success:!0})});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F):F();var O=location.href;new MutationObserver(()=>{location.href!==O&&(O=location.href,console.log("Page navigation detected, reinitializing..."),c.clear(),setTimeout(()=>{s&&d()},1e3))}).observe(document,{subtree:!0,childList:!0});console.log("Slop Block content script loaded");})();
