"use strict";(()=>{var C=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);async function A(e,t){try{return(await chrome.storage.sync.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get storage value for key ${e}:`,o),t}}async function R(e,t){try{return(await chrome.storage.local.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get local storage value for key ${e}:`,o),t}}async function M(e,t){try{await chrome.storage.local.set({[e]:t})}catch(o){if(o instanceof Error&&o.message.includes("Extension context invalidated")){console.warn(`Extension context invalidated - skipping storage save for ${e}`);return}console.error(`Failed to set local storage value for key ${e}:`,o)}}var l,_,P=C(()=>{"use strict";l={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode",OPENROUTER_API_KEY:"openRouterApiKey",AI_DETECTION_ENABLED:"aiDetectionEnabled",SYSTEM_PROMPT:"systemPrompt",BATCH_SIZE:"batchSize",CUSTOM_PROMPT:"customPrompt",PROCESSED_TWEET_IDS:"processedTweetIds",LLM_ANALYZED_IDS:"llmAnalyzedIds",COLLAPSED_TWEET_IDS:"collapsedTweetIds"},_={[l.SLOP_BLOCK_ENABLED]:!1,[l.DETECTION_COUNT]:0,[l.USER_WHITELIST]:[],[l.BLUR_MODE]:!0,[l.OPENROUTER_API_KEY]:"",[l.AI_DETECTION_ENABLED]:!1,[l.SYSTEM_PROMPT]:`You are an expert at detecting AI-generated motivational slop, engagement bait, and generic inspirational content on social media. Analyze each tweet and classify it as slop or genuine content.

SLOP INDICATORS:
\u2022 Motivational clich\xE9s: "mindset is everything", "follow your dreams", "hustle harder", "grind never stops"
\u2022 Business/money schemes: "$10k/month", "passive income", "quit my job", "financial freedom"
\u2022 Generic advice patterns: "here's what I learned", "X things nobody tells you", "stop doing this, start doing this"
\u2022 Engagement bait: "unpopular opinion", "let that sink in", "read that again", "thread \u{1F9F5}"
\u2022 AI-like structure: numbered lists, formulaic advice, excessive emojis
\u2022 Buzzwords: entrepreneur, transformation, breakthrough, optimize, unlock potential
\u2022 Sales pitches: "DM me", "link in bio", "limited time", "exclusive access"

Return JSON format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]} where id matches tweet position (0-14).`,[l.BATCH_SIZE]:10,[l.CUSTOM_PROMPT]:"",[l.PROCESSED_TWEET_IDS]:[],[l.LLM_ANALYZED_IDS]:[],[l.COLLAPSED_TWEET_IDS]:[]}});function b(...e){V&&console.log("[SlopBlock DOM]",...e)}function H(){return Array.from(document.querySelectorAll('[data-testid="tweet"]')).filter(e=>{let t=e.closest("article");return t&&!t.hasAttribute("data-slop-processed")})}function D(e){let t=e.querySelectorAll('a[href*="/status/"]');for(let o of Array.from(t)){let r=o.href.match(/\/status\/(\d+)/);if(r&&r[1])return r[1]}return null}function Z(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return"h"+Math.abs(t)}function B(e){var t,o,n,r;try{let a=D(e),c=Q(e);if(!c)return b("No text extracted for tweet:",e),null;X.textExtracted++;let g=e.querySelector('[data-testid="User-Name"]'),p=((t=g==null?void 0:g.textContent)==null?void 0:t.trim())||"unknown",d={replies:e.querySelector('[data-testid="reply"]'),retweets:e.querySelector('[data-testid="retweet"]'),likes:e.querySelector('[data-testid="like"]')},i={replies:I(((o=d.replies)==null?void 0:o.textContent)||"0"),retweets:I(((n=d.retweets)==null?void 0:n.textContent)||"0"),likes:I(((r=d.likes)==null?void 0:r.textContent)||"0")},s={id:a||Z(c),text:c,username:p,engagement:i,element:e,timestamp:Date.now()};return b("Extracted tweet data:",{username:p,textLength:c.length,engagement:i,textPreview:c.substring(0,100)+"..."}),s}catch(a){return console.error("Error extracting tweet data:",a),null}}function Q(e){var d,i;let t="",n=e.querySelector('[data-testid="tweetText"]');if((d=n==null?void 0:n.textContent)!=null&&d.trim())return t=n.textContent.trim(),b("Strategy 1 success:",t.substring(0,50)),t;let r=["[lang] span",".css-901oao span",'[dir="auto"] span'];for(let s of r){let u=e.querySelectorAll(s),f=Array.from(u).map(h=>{var T;return(T=h.textContent)==null?void 0:T.trim()}).filter(h=>h&&h.length>0);if(f.length>0&&(t=f.join(" ").trim(),t.length>10))return b("Strategy 2 success:",t.substring(0,50)),t}let a=e.querySelectorAll('[lang]:not([lang=""])');for(let s of Array.from(a)){let u=(i=s.textContent)==null?void 0:i.trim();u&&u.length>t.length&&(t=u)}if(t.trim().length>10)return b("Strategy 3 success:",t.substring(0,50)),t.trim();let c=e.querySelector('[data-testid="tweet"]')||e,p=ee(c).map(s=>{var u;return(u=s.textContent)==null?void 0:u.trim()}).filter(s=>s!==void 0&&s.length>3).filter(s=>!te(s));return p.length>0?(t=p.join(" ").trim(),b("Strategy 4 success:",t.substring(0,50)),t):(b("All strategies failed for element:",e),"")}function ee(e){let t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var p;let a=r.parentElement;if(!a)return NodeFilter.FILTER_REJECT;let c=a.tagName.toLowerCase();if(["script","style","svg"].includes(c))return NodeFilter.FILTER_REJECT;let g=(p=r.textContent)==null?void 0:p.trim();return!g||g.length<3?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),n;for(;n=o.nextNode();)t.push(n);return t}function te(e){return[/^\d+[hms]$/,/^Â·$/,/^@/,/^Show this thread$/,/^Replying to/,/^Quote Tweet$/,/^Retweet$/,/^\d+$/,/^Show replies$/,/^More$/].some(o=>o.test(e.trim()))}function I(e){if(!e)return 0;let t=e.replace(/[^\d.KMkm]/g,""),o=parseFloat(t);return isNaN(o)?0:t.toLowerCase().includes("k")?Math.round(o*1e3):t.toLowerCase().includes("m")?Math.round(o*1e6):Math.round(o)}function k(e){if(e.hasAttribute("data-ai-collapsed"))return;e.querySelectorAll(".ai-tweet-bar").forEach(r=>r.remove());let o=e.innerHTML;e.setAttribute("data-ai-original-content",o);let n=document.createElement("div");n.className="ai-tweet-bar",n.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 8px 12px;
    margin: 4px 0;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 20px;
  `,n.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">ai tweet hidden</span>
    <span style="color: #657786; font-size: 12px;">\u25BC</span>
  `,n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#f7f9fa"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="white"}),n.addEventListener("click",r=>{r.stopPropagation(),oe(e)}),e.innerHTML="",e.appendChild(n),e.setAttribute("data-ai-collapsed","true"),e.style.display="block"}function oe(e){if(!e.hasAttribute("data-ai-collapsed"))return;let t=D(e);t&&window.slopBlockRemoveFromCollapsed&&window.slopBlockRemoveFromCollapsed(t);let o=e.getAttribute("data-ai-original-content");o&&(e.innerHTML=o),e.querySelectorAll(".ai-hide-header").forEach(a=>a.remove());let r=document.createElement("div");r.className="ai-hide-header",r.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 6px 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
  `,r.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">\u{1F916} hide ai tweet</span>
    <span style="color: #657786; font-size: 12px;">\u25B2</span>
  `,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#f7f9fa"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="white"}),r.addEventListener("click",a=>{a.stopPropagation(),k(e)}),e.insertBefore(r,e.firstChild),e.removeAttribute("data-ai-collapsed"),e.removeAttribute("data-ai-original-content")}var V,X,F=C(()=>{"use strict";V=window.DEBUG_SLOP_DETECTION||!1;X={totalTweets:0,textExtracted:0,slopDetected:0}});async function $(e){var g,p,d;if(e.length===0)return[];let t,o;try{if(t=await A(l.OPENROUTER_API_KEY,_[l.OPENROUTER_API_KEY]),!t)return console.warn("[OpenRouter] No API key set \u2013 skipping remote analysis"),null;o=await A(l.SYSTEM_PROMPT,_[l.SYSTEM_PROMPT])}catch{return console.warn("[OpenRouter] Extension context invalidated, skipping analysis"),null}let n=`Analyze these ${e.length} tweets and identify which are AI-generated motivational slop, engagement bait, or generic inspirational content. Return JSON with format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]}

Tweets:
${e.map((i,s)=>`${s}: ${i}`).join(`

`)}`,r=[{role:"system",content:o},{role:"user",content:n}],a={model:"meta-llama/llama-4-maverick",temperature:.1,max_tokens:1e3,messages:r,response_format:{type:"json_object"},provider:"groq"},c=performance.now();try{console.log("[OpenRouter] Sending request with",e.length,"tweets via Groq provider");let i=await fetch(q,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"SlopBlock Extension"},body:JSON.stringify(a)}),s=Math.round(performance.now()-c);if(!i.ok){let L=await i.text();return console.warn("[OpenRouter] Groq provider failed (HTTP",i.status,"), attempting fallback:",L),await x(e,r,t,s)}let u=await i.text();if(console.log(`[OpenRouter] \u2705 Groq provider success (${s}ms) - Response length:`,u.length),!u.trim())return console.error("[OpenRouter] Empty response from Groq provider"),await x(e,r,t,s);let f;try{f=JSON.parse(u)}catch(L){return console.error("[OpenRouter] Failed to parse Groq response JSON:",L),await x(e,r,t,s)}let h=i.headers.get("x-or-provider")||"unknown",T=i.headers.get("x-or-model")||"unknown";console.log(`[OpenRouter] Provider confirmed: ${h}, Model: ${T}, Response time: ${s}ms`);let y=(d=(p=(g=f==null?void 0:f.choices)==null?void 0:g[0])==null?void 0:p.message)==null?void 0:d.content;if(!y)return console.error("[OpenRouter] No content in Groq response data:",f),await x(e,r,t,s);console.log("[OpenRouter] Groq AI response content:",y);let m;try{m=JSON.parse(y)}catch(L){return console.error("[OpenRouter] Failed to parse Groq AI response JSON:",L),await x(e,r,t,s)}return console.log(`[OpenRouter] \u2705 Groq analysis complete (${s}ms):`,m),m.results||m}catch(i){let s=Math.round(performance.now()-c);return console.warn("[OpenRouter] Groq provider network error, attempting fallback:",i),await x(e,r,t,s)}}async function x(e,t,o,n){var c,g,p;console.log("[OpenRouter] \u{1F504} Falling back to standard provider routing");let r={model:"meta-llama/llama-4-maverick",temperature:.1,max_tokens:1e3,messages:t,response_format:{type:"json_object"}},a=performance.now();try{let d=await fetch(q,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"SlopBlock Extension"},body:JSON.stringify(r)}),i=Math.round(performance.now()-a);if(!d.ok){let m=await d.text();return console.error("[OpenRouter] Fallback also failed (HTTP",d.status,"):",m),null}let s=await d.text();if(console.log(`[OpenRouter] \u2705 Fallback provider success (${i}ms vs ${n}ms Groq attempt)`),!s.trim())return console.error("[OpenRouter] Empty response from fallback provider"),null;let u;try{u=JSON.parse(s)}catch(m){return console.error("[OpenRouter] Failed to parse fallback response JSON:",m),null}let f=d.headers.get("x-or-provider")||"unknown",h=d.headers.get("x-or-model")||"unknown";console.log(`[OpenRouter] Fallback provider: ${f}, Model: ${h}, Response time: ${i}ms`);let T=(p=(g=(c=u==null?void 0:u.choices)==null?void 0:c[0])==null?void 0:g.message)==null?void 0:p.content;if(!T)return console.error("[OpenRouter] No content in fallback response data:",u),null;console.log("[OpenRouter] Fallback AI response content:",T);let y;try{y=JSON.parse(T)}catch(m){return console.error("[OpenRouter] Failed to parse fallback AI response JSON:",m),null}return console.log(`[OpenRouter] \u2705 Fallback analysis complete (${i}ms):`,y),y.results||y}catch(d){let i=Math.round(performance.now()-a);return console.error(`[OpenRouter] Fallback network error after ${i}ms:`,d),null}}var q,U=C(()=>{"use strict";P();q="https://openrouter.ai/api/v1/chat/completions"});var me=K(()=>{P();F();U();console.log("\u{1F50D} SlopBlock: Script loaded at",new Date().toISOString());console.log("\u{1F50D} SlopBlock: URL:",window.location.href);console.log("\u{1F50D} SlopBlock: Document ready state:",document.readyState);var W=200,G=10,z=15,S=[],E=[],O=[],J=new Map,w=!1,v=null;async function re(){S=await R(l.PROCESSED_TWEET_IDS,[])}async function ne(){await M(l.PROCESSED_TWEET_IDS,S)}async function se(){E=await R(l.COLLAPSED_TWEET_IDS,[]),console.log("[Collapsed] Loaded",E.length,"previously collapsed tweet IDs")}async function j(){await M(l.COLLAPSED_TWEET_IDS,E)}function ae(e){var t;E.includes(e)||(E.push(e),E.length>W&&E.splice(0,G),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&j())}function ie(e){var t;S.push(e),S.length>W&&S.splice(0,G),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&ne()}async function le(e){let t=e.map(o=>o.text);console.log("[Batch] Analyzing",e.length,"tweets with OpenRouter..."),console.log("[Batch] Tweet texts being sent:",t);try{let o=await $(t);if(console.log("[Batch] OpenRouter returned:",o),!o)return console.log("[Batch] No API key or analysis failed"),new Set;let n=new Set;return o.forEach((r,a)=>{var c,g;if(console.log("[Batch] Processing result",a,":",r),r.isSlop&&a<e.length){let p=e[a].id;n.add(p),console.log("[Flagged]",p,"confidence:",r.confidence,"text:",e[a].text.substring(0,100))}else console.log("[Clean]",(c=e[a])==null?void 0:c.id,"text:",(g=e[a])==null?void 0:g.text.substring(0,100))}),console.log("[Batch] Final result: Flagged",n.size,"out of",e.length,"tweets"),console.log("[Batch] Flagged IDs:",Array.from(n)),n}catch(o){return console.error("[Batch] Analysis error:",o),new Set}}function ce(e){e.forEach(t=>{let o=J.get(t);o&&(k(o),ae(t),console.log("[Collapsed AI Tweet]",t))})}async function de(){if(O.length<z)return;let e=O.splice(0,z),t=await le(e);ce(t)}function N(e){if(!w)return;let t=B(e);if(!t)return;let{id:o,text:n}=t;if(o){if(J.set(o,e),E.includes(o)){e.hasAttribute("data-ai-collapsed")||(k(e),console.log("[Re-collapsed Previously Flagged Tweet]",o));return}S.includes(o)||(console.log("[Tweet]",o,n.substring(0,120)),ie(o),O.push({id:o,text:n,element:e}),de())}}function ue(){w&&H().forEach(e=>N(e))}function pe(){v||(v=new MutationObserver(e=>{w&&e.forEach(t=>{t.addedNodes.forEach(o=>{var n;if(o.nodeType===Node.ELEMENT_NODE){let r=o;r.matches('[data-testid="tweet"]')?N(r):(n=r.querySelectorAll)==null||n.call(r,'[data-testid="tweet"]').forEach(a=>N(a))}})})}),v.observe(document.body,{childList:!0,subtree:!0}))}function ge(){v&&(v.disconnect(),v=null)}function fe(e){var o;let t=E.indexOf(e);t!==-1&&(E.splice(t,1),console.log("[Manual Expansion] Removed tweet from collapsed list:",e),(o=chrome==null?void 0:chrome.runtime)!=null&&o.id&&j())}async function Y(){let e=await A(l.SLOP_BLOCK_ENABLED,!1);console.log("[Extension] State changed to:",e?"ENABLED":"DISABLED"),e&&!w?(w=!0,window.slopBlockRemoveFromCollapsed=fe,pe(),ue()):!e&&w&&(w=!1,window.slopBlockRemoveFromCollapsed=void 0,ge(),O.length=0)}chrome.runtime.onMessage.addListener(e=>{e.action==="stateChanged"&&Y()});(async()=>(await re(),await se(),await Y()))()});me();})();
