"use strict";(()=>{var d=!1;function D(e){d=e}function H(e){let n=[],t=e.querySelectorAll('[data-testid="tweet"]');return d&&console.log(`\u{1F50D} findTweetElements: Found ${t.length} tweet containers in node`),t.forEach((o,s)=>{let a=W(o);a?(n.push(a),d&&console.log(`\u2705 Tweet ${s+1} extracted successfully`)):d&&console.log(`\u274C Tweet ${s+1} failed extraction`)}),n}function z(e){if(!d)return;console.log("=== TWEET DOM ANALYSIS ==="),console.log("Main element:",e),console.log("innerHTML preview:",e.innerHTML.substring(0,300)),['[data-testid="tweetText"]',".css-1jxf684",".css-1qaijid","[lang]",'span[dir="auto"]',"div[lang]",'span:not([class*="icon"]):not([aria-hidden="true"])'].forEach(o=>{var a;let s=e.querySelector(o);(a=s==null?void 0:s.textContent)!=null&&a.trim()?console.log(`\u2713 Selector "${o}":`,s.textContent.substring(0,100)):console.log(`\u2717 Selector "${o}": no content`)});let t=B(e);console.log(`Found ${t.length} text nodes`),t.slice(0,3).forEach((o,s)=>{var a;console.log(`Text node ${s}:`,(a=o.textContent)==null?void 0:a.substring(0,100))})}function W(e){var n;try{z(e);let t=V(e);d&&(console.log("Extracted text length:",t.length),console.log("Extracted text preview:",t.substring(0,150)));let o=M(e,"like"),s=M(e,"retweet"),a=M(e,"reply"),u=!!e.querySelector('[data-testid="icon-verified"]'),p=e.querySelector('[data-testid="User-Name"] a'),h=((n=p==null?void 0:p.textContent)==null?void 0:n.replace("@",""))||"";return{element:e,textContent:t,metadata:{likes:o,retweets:s,replies:a,isVerified:u,username:h}}}catch(t){return console.warn("Failed to extract tweet data:",t),null}}function V(e){var p,h,L,A;let n=e.querySelector('[data-testid="tweetText"]');if((p=n==null?void 0:n.textContent)!=null&&p.trim())return d&&console.log('\u{1F4DD} Text extracted via primary selector [data-testid="tweetText"]'),n.textContent.trim();let t=['[data-testid="tweetText"] span','div[data-testid="tweetText"]','[lang] span[dir="ltr"]','[lang] span[dir="auto"]'];for(let b of t){let r=e.querySelector(b),S=(h=r==null?void 0:r.textContent)==null?void 0:h.trim();if(S&&S.length>10)return d&&console.log(`\u{1F4DD} Text extracted via selector: ${b}`),S}let o=e.querySelectorAll("[lang]");for(let b of Array.from(o)){let r=(L=b.textContent)==null?void 0:L.trim();if(r&&r.length>20&&!r.includes("http")&&!r.includes("@")&&!r.includes("\xB7")&&!r.match(/^\d+[mhsd]$/))return d&&console.log("\u{1F4DD} Text extracted via language-tagged element"),r}let s=B(e),a="";for(let b of s){let r=(A=b.textContent)==null?void 0:A.trim();r&&r.length>5&&!r.includes("\xB7")&&!r.match(/^\d+[mhs]$/)&&!r.includes("Show this thread")&&!r.includes("Replying to")&&!r.includes("Translate")&&!r.includes("View post analytics")&&(a+=r+" ")}let u=a.trim();return d&&console.log(`\u{1F4DD} Text extraction result: "${u.substring(0,100)}..." (length: ${u.length})`),u}function B(e){let n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),t=[],o;for(;o=n.nextNode();){let s=o.parentElement;s&&(s.tagName==="SCRIPT"||s.tagName==="STYLE"||s.hasAttribute("aria-hidden")||s.style.display==="none"||t.push(o))}return t}function M(e,n){var t;try{let o="";switch(n){case"like":o='[data-testid="like"]';break;case"retweet":o='[data-testid="retweet"]';break;case"reply":o='[data-testid="reply"]';break}let s=e.querySelector(o),a=s==null?void 0:s.querySelector('[data-testid$="count"]'),u=((t=a==null?void 0:a.textContent)==null?void 0:t.trim())||"0";return j(u)}catch{return 0}}function j(e){if(!e||e==="0")return 0;let n=e.toLowerCase(),t=parseFloat(n);return n.includes("k")?Math.floor(t*1e3):n.includes("m")?Math.floor(t*1e6):Math.floor(t)||0}function O(e){if(e.hasAttribute("data-slop-collapsed"))return;d&&console.log("\u{1F3AF} Collapsing tweet element:",e),e.querySelectorAll(".slop-collapse-header").forEach(s=>s.remove()),e.setAttribute("data-original-content",e.innerHTML),e.setAttribute("data-slop-collapsed","true");let t=document.createElement("div");t.className="slop-collapsed",t.style.cssText=`
    background: rgb(247, 249, 250) !important;
    border: 1px solid rgb(207, 217, 222) !important;
    border-radius: 16px !important;
    padding: 12px 16px !important;
    margin: 2px 0 !important;
    cursor: pointer !important;
    transition: background-color 0.2s ease !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif !important;
    display: block !important;
    width: 100% !important;
    box-sizing: border-box !important;
  `,t.innerHTML=`
    <div class="slop-collapsed-header" style="display: flex !important; align-items: center !important; justify-content: space-between !important; width: 100% !important;">
      <span class="slop-collapsed-text" style="color: rgb(83, 100, 113) !important; font-size: 15px !important; font-weight: 400 !important; line-height: 20px !important;">AI generated content detected</span>
      <span class="slop-expand-icon" style="color: rgb(83, 100, 113) !important; font-size: 14px !important; margin-left: 8px !important;">\u25BC</span>
    </div>
  `,t.addEventListener("mouseenter",()=>{t.style.background="rgb(239, 243, 244) !important"}),t.addEventListener("mouseleave",()=>{t.style.background="rgb(247, 249, 250) !important"}),t.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault(),d&&console.log("\u{1F504} Expanding collapsed tweet"),K(e)});let o=e;o.innerHTML="",o.appendChild(t),o.classList.add("slop-tweet-collapsed"),o.style.display="block",o.style.visibility="visible",console.log("\u2705 Tweet collapsed successfully, stub element:",t)}function K(e){if(!e.hasAttribute("data-slop-collapsed"))return;console.log("\u{1F504} Expanding tweet element:",e);let n=e.getAttribute("data-original-content");n&&(e.innerHTML=n),e.querySelectorAll(".slop-collapse-header").forEach(s=>s.remove());let o=document.createElement("div");o.className="slop-collapse-header",o.style.cssText=`
    background: rgb(247, 249, 250) !important;
    border: 1px solid rgb(207, 217, 222) !important;
    border-radius: 12px !important;
    padding: 8px 12px !important;
    margin-bottom: 8px !important;
    cursor: pointer !important;
    transition: background-color 0.2s ease !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif !important;
    display: block !important;
  `,o.innerHTML=`
    <div class="slop-collapse-button" style="display: flex !important; align-items: center !important; justify-content: space-between !important; width: 100% !important;">
      <span class="slop-collapse-text" style="color: rgb(83, 100, 113) !important; font-size: 13px !important; font-weight: 400 !important;">Hide AI content</span>
      <span class="slop-collapse-icon" style="color: rgb(83, 100, 113) !important; font-size: 12px !important; margin-left: 8px !important;">\u25B2</span>
    </div>
  `,o.addEventListener("mouseenter",()=>{o.style.background="rgb(239, 243, 244) !important"}),o.addEventListener("mouseleave",()=>{o.style.background="rgb(247, 249, 250) !important"}),o.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault(),console.log("\u{1F3AF} Collapsing expanded tweet"),O(e)}),e.insertBefore(o,e.firstChild),e.classList.remove("slop-tweet-collapsed"),e.classList.add("slop-tweet-expanded"),e.removeAttribute("data-slop-collapsed"),console.log("\u2705 Tweet expanded successfully with collapse header")}function $(e,n){O(e)}function w(e,n){if(!d)return;let t=e;t.classList.remove("slop-debug-processed","slop-debug-detected"),n?(t.classList.add("slop-debug-detected"),t.style.border="2px solid red",t.style.backgroundColor="rgba(255, 0, 0, 0.1)"):(t.classList.add("slop-debug-processed"),t.style.border="1px dashed green")}function C(e){let n=e;if(e.hasAttribute("data-slop-collapsed")){let o=e.getAttribute("data-original-content");o&&(e.innerHTML=o),e.removeAttribute("data-original-content"),e.removeAttribute("data-slop-collapsed")}e.querySelectorAll(".slop-collapse-header").forEach(o=>o.remove()),n.classList.remove("slop-tweet-collapsed","slop-tweet-expanded","slop-blurred","slop-hidden"),n.style.display="",n.style.visibility="",console.log("\u{1F9F9} Removed all tweet effects from element")}function F(e,n){let t;return function(...o){clearTimeout(t),t=window.setTimeout(()=>e.apply(this,o),n)}}async function T(e,n){try{return(await chrome.storage.sync.get({[e]:n}))[e]}catch(t){return console.error(`Failed to get storage value for key ${e}:`,t),n}}var c={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode"},v={[c.SLOP_BLOCK_ENABLED]:!1,[c.DETECTION_COUNT]:0,[c.USER_WHITELIST]:[],[c.BLUR_MODE]:!0};var Y=[/at first.*then.*but eventually/i,/first.*then.*finally/i,/started.*then.*now/i,/people buy from people who:/i,/want to \w+\? here's how/i,/you don't need:.*you need:/i,/here's what \w+ taught me:/i,/\d{3,}.*here's how/i,/\d{3,}.*here's the/i,/\$\d{1,3}k.*in \d+ days/i,/\d+\s*million.*here's/i,/volume wins on \w+/i,/the answer is more/i,/consistency beats perfection/i,/growth is simply.*\d+%.*\d+%/i,/success is \d+%.*\d+%/i,/went from \$?\d+.*to \$?\d+/i,/\d+\s*(downloads|users|followers)/i,/made \$\d+.*in \d+ months/i,/from zero to \$\d+/i,/stop \w+ing everything/i,/stop making excuses/i,/you're overthinking/i,/quit complaining/i,/you can be a \w+ & still:/i,/successful people don't:/i,/millionaires do this:/i,/your future self will thank you/i,/isn't coming to save you/i,/bet on yourself/i],N={maxEmojis:3,maxLineBreaks:6};function _(e,n){return G(e,n).isSlop}function G(e,n){let t=[],o=0;Y.forEach((p,h)=>{p.test(e)&&(t.push(`Matched slop pattern ${h+1}`),o+=.4)});let s=(e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/gu)||[]).length,a=(e.match(/\n/g)||[]).length;return s>N.maxEmojis&&(t.push(`Too many emojis: ${s}`),o+=.3),a>N.maxLineBreaks&&(t.push(`Too many line breaks: ${a}`),o+=.3),e.toLowerCase().includes("ai generated")&&(t.push('Contains "AI generated" phrase'),o+=.8),e.toLowerCase().includes("as an ai")&&(t.push("Contains AI self-identification"),o+=.9),n.likes+n.retweets+n.replies===0&&e.length>200&&(t.push("Long tweet with no engagement"),o+=.3),o=Math.min(o,1),{isSlop:o>.3,confidence:o,reasons:t}}function I(e,n){if(!e||!n.length)return!1;let t=e.toLowerCase().replace("@","");return n.some(o=>o.toLowerCase()===t)}var f=null,l=!1,E=!0,i=!1,y=[],m=new Set;chrome.storage.onChanged.addListener(async(e,n)=>{if(i&&console.log("\u{1F504} Storage change detected:",{area:n,changes:e}),n==="sync"){if(e[c.SLOP_BLOCK_ENABLED]){let t=e[c.SLOP_BLOCK_ENABLED].newValue;t!==l&&(l=t,console.log(`Extension ${l?"ENABLED":"DISABLED"}`),l?(k(),g()):(q(),x()))}if(e[c.BLUR_MODE]){let t=e[c.BLUR_MODE].newValue;t!==E&&(E=t,l&&(x(),g()))}e[c.USER_WHITELIST]&&(y=e[c.USER_WHITELIST].newValue,l&&(x(),g()))}});async function R(){try{l=await T(c.SLOP_BLOCK_ENABLED,v[c.SLOP_BLOCK_ENABLED]),E=await T(c.BLUR_MODE,v[c.BLUR_MODE]),y=await T(c.USER_WHITELIST,v[c.USER_WHITELIST]),i=location.hash==="#slopDebug",D(i),i&&(console.log("\u{1F527} DEBUG MODE ENABLED - Verbose logging active"),console.log("\u{1F4CA} Initial state:",{isEnabled:l,blurMode:E,whitelistLength:y.length})),console.log(`Slop Block initialized: ${l?"enabled":"disabled"}`),l&&(k(),g())}catch(e){console.error("Failed to initialize Slop Block:",e)}}function k(){f&&f.disconnect();let e=null,n=[];f=new MutationObserver(t=>{l&&(t.forEach(o=>{o.addedNodes.forEach(s=>{s.nodeType===Node.ELEMENT_NODE&&n.push(s)})}),e&&clearTimeout(e),e=setTimeout(()=>{n.length>0&&(i&&console.log(`\u{1F504} Batch processing ${n.length} DOM changes`),n.forEach(o=>P(o)),n=[])},200))}),f.observe(document.body,{childList:!0,subtree:!0}),i&&console.log("\u{1F441}\uFE0F DOM observer started with batching")}function q(){f&&(f.disconnect(),f=null),i&&console.log("DOM observer stopped")}var g=F(()=>{if(!l)return;(()=>{let n=document.querySelectorAll('[data-testid="tweet"]').length;if(i&&console.log(`\u{1F50D} Found ${n} tweet elements in DOM`),n>0){let t=performance.now();if(P(document.body),i){let o=performance.now();console.log(`\u23F1\uFE0F Tweet processing completed in ${(o-t).toFixed(2)}ms`)}}})()},300);function P(e){let n=H(e);i&&(console.log(`\u{1F426} Found ${n.length} tweet elements`),n.length===0&&(console.log("\u{1F4C4} No tweets found - checking selectors on current page"),['[data-testid="tweet"]','article[data-testid="tweet"]','[data-testid="tweetText"]'].forEach(o=>{let s=e.querySelectorAll(o);console.log(`\u{1F3AF} Selector "${o}": ${s.length} elements`)}))),n.forEach((t,o)=>{i&&console.log(`\u{1F504} Processing tweet ${o+1}/${n.length}`),X(t)})}function X(e){if(!m.has(e.element))try{if(i&&console.log("\u{1F4DD} Tweet details:",{textLength:e.textContent.length,textPreview:e.textContent.substring(0,50)+(e.textContent.length>50?"...":""),username:e.metadata.username}),e.metadata.username&&I(e.metadata.username,y)){i&&console.log(`\u2705 User "${e.metadata.username}" is whitelisted, skipping`),w(e.element,!1),m.add(e.element);return}_(e.textContent,e.metadata)?(console.log("\u{1F6A8} AI content detected and collapsed"),i&&console.log("\u{1F4CA} Details:",{text:e.textContent.substring(0,100)+"...",username:e.metadata.username,engagement:{likes:e.metadata.likes,retweets:e.metadata.retweets,replies:e.metadata.replies}}),$(e.element,"hide"),w(e.element,!0),Q({action:"updateCount",count:1})):(C(e.element),w(e.element,!1)),m.add(e.element),i&&console.log(`\u{1F4CA} Total processed tweets: ${m.size}`)}catch(n){console.error("Error processing tweet:",n),i&&console.error("Tweet data:",{element:e.element,text:e.textContent})}}function x(){m.forEach(e=>{C(e)}),m.clear(),i&&console.log("All tweet effects cleared")}function J(){try{return!!(chrome.runtime&&chrome.runtime.id)}catch{return!1}}function Q(e){if(!J()){i&&console.log("\u26A0\uFE0F Extension context invalid, skipping runtime message");return}try{chrome.runtime.sendMessage(e).catch(()=>{})}catch{}}chrome.runtime.onMessage.addListener((e,n,t)=>{switch(i&&console.log("Content script received message:",e),e.action){case"toggleSlop":l=e.enabled,console.log(`Extension ${l?"ENABLED":"DISABLED"} via message`),l?(k(),g()):(q(),x());break;case"updateSettings":e.blurMode!==void 0&&(E=e.blurMode,l&&(x(),g())),e.whitelist!==void 0&&(y=e.whitelist,l&&(x(),g()));break;default:i&&console.warn("Unknown message action:",e.action)}return t({success:!0}),!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R();var U=location.href;new MutationObserver(()=>{location.href!==U&&(U=location.href,i&&console.log("Page navigation detected, reinitializing..."),m.clear(),setTimeout(()=>{l&&g()},1e3))}).observe(document,{subtree:!0,childList:!0});})();
