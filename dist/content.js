"use strict";(()=>{var v=(e,t)=>()=>(e&&(t=e(e=0)),t);var U=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);async function b(e,t){try{return(await chrome.storage.sync.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get storage value for key ${e}:`,o),t}}async function A(e,t){try{return(await chrome.storage.local.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get local storage value for key ${e}:`,o),t}}async function L(e,t){try{await chrome.storage.local.set({[e]:t})}catch(o){if(o instanceof Error&&o.message.includes("Extension context invalidated")){console.warn(`Extension context invalidated - skipping storage save for ${e}`);return}console.error(`Failed to set local storage value for key ${e}:`,o)}}var s,k,C=v(()=>{"use strict";s={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode",GROQ_API_KEY:"groqApiKey",AI_DETECTION_ENABLED:"aiDetectionEnabled",SYSTEM_PROMPT:"systemPrompt",BATCH_SIZE:"batchSize",CUSTOM_PROMPT:"customPrompt",PROCESSED_TWEET_IDS:"processedTweetIds",LLM_ANALYZED_IDS:"llmAnalyzedIds",COLLAPSED_TWEET_IDS:"collapsedTweetIds"},k={[s.SLOP_BLOCK_ENABLED]:!1,[s.DETECTION_COUNT]:0,[s.USER_WHITELIST]:[],[s.BLUR_MODE]:!0,[s.GROQ_API_KEY]:"",[s.AI_DETECTION_ENABLED]:!1,[s.SYSTEM_PROMPT]:`You are an expert at detecting AI-generated motivational slop, engagement bait, and generic inspirational content on social media. Analyze each tweet and classify it as slop or genuine content.

SLOP INDICATORS:
\u2022 Motivational clich\xE9s: "mindset is everything", "follow your dreams", "hustle harder", "grind never stops"
\u2022 Business/money schemes: "$10k/month", "passive income", "quit my job", "financial freedom"
\u2022 Generic advice patterns: "here's what I learned", "X things nobody tells you", "stop doing this, start doing this"
\u2022 Engagement bait: "unpopular opinion", "let that sink in", "read that again", "thread \u{1F9F5}"
\u2022 AI-like structure: numbered lists, formulaic advice, excessive emojis
\u2022 Buzzwords: entrepreneur, transformation, breakthrough, optimize, unlock potential
\u2022 Sales pitches: "DM me", "link in bio", "limited time", "exclusive access"

Return JSON format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]} where id matches tweet position (0-14).`,[s.BATCH_SIZE]:10,[s.CUSTOM_PROMPT]:"",[s.PROCESSED_TWEET_IDS]:[],[s.LLM_ANALYZED_IDS]:[],[s.COLLAPSED_TWEET_IDS]:[]}});function B(){return Array.from(document.querySelectorAll('[data-testid="tweet"]')).filter(e=>{let t=e.closest("article");return t&&!t.hasAttribute("data-slop-processed")})}function N(e){let t=e.querySelectorAll('a[href*="/status/"]');for(let o of Array.from(t)){let r=o.href.match(/\/status\/(\d+)/);if(r&&r[1])return r[1]}return null}function Y(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return"h"+Math.abs(t)}function _(e){var t,o,n,r;try{let a=N(e),c=J(e);if(!c)return null;W.textExtracted++;let p=e.querySelector('[data-testid="User-Name"]'),u=((t=p==null?void 0:p.textContent)==null?void 0:t.trim())||"unknown",i={replies:e.querySelector('[data-testid="reply"]'),retweets:e.querySelector('[data-testid="retweet"]'),likes:e.querySelector('[data-testid="like"]')},g={replies:M(((o=i.replies)==null?void 0:o.textContent)||"0"),retweets:M(((n=i.retweets)==null?void 0:n.textContent)||"0"),likes:M(((r=i.likes)==null?void 0:r.textContent)||"0")};return{id:a||Y(c),text:c,username:u,engagement:g,element:e,timestamp:Date.now()}}catch(a){return console.error("Error extracting tweet data:",a),null}}function J(e){var i,g;let t="",n=e.querySelector('[data-testid="tweetText"]');if((i=n==null?void 0:n.textContent)!=null&&i.trim())return t=n.textContent.trim(),t;let r=["[lang] span",".css-901oao span",'[dir="auto"] span'];for(let l of r){let d=e.querySelectorAll(l),h=Array.from(d).map(f=>{var E;return(E=f.textContent)==null?void 0:E.trim()}).filter(f=>f&&f.length>0);if(h.length>0&&(t=h.join(" ").trim(),t.length>10))return t}let a=e.querySelectorAll('[lang]:not([lang=""])');for(let l of Array.from(a)){let d=(g=l.textContent)==null?void 0:g.trim();d&&d.length>t.length&&(t=d)}if(t.trim().length>10)return t.trim();let c=e.querySelector('[data-testid="tweet"]')||e,u=j(c).map(l=>{var d;return(d=l.textContent)==null?void 0:d.trim()}).filter(l=>l!==void 0&&l.length>3).filter(l=>!G(l));return u.length>0?(t=u.join(" ").trim(),t):""}function j(e){let t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var u;let a=r.parentElement;if(!a)return NodeFilter.FILTER_REJECT;let c=a.tagName.toLowerCase();if(["script","style","svg"].includes(c))return NodeFilter.FILTER_REJECT;let p=(u=r.textContent)==null?void 0:u.trim();return!p||p.length<3?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),n;for(;n=o.nextNode();)t.push(n);return t}function G(e){return[/^\d+[hms]$/,/^Â·$/,/^@/,/^Show this thread$/,/^Replying to/,/^Quote Tweet$/,/^Retweet$/,/^\d+$/,/^Show replies$/,/^More$/].some(o=>o.test(e.trim()))}function M(e){if(!e)return 0;let t=e.replace(/[^\d.KMkm]/g,""),o=parseFloat(t);return isNaN(o)?0:t.toLowerCase().includes("k")?Math.round(o*1e3):t.toLowerCase().includes("m")?Math.round(o*1e6):Math.round(o)}function x(e){if(e.hasAttribute("data-ai-collapsed"))return;e.querySelectorAll(".ai-tweet-bar").forEach(r=>r.remove());let o=e.innerHTML;e.setAttribute("data-ai-original-content",o);let n=document.createElement("div");n.className="ai-tweet-bar",n.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 8px 12px;
    margin: 4px 0;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 20px;
  `,n.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">ai tweet hidden</span>
    <span style="color: #657786; font-size: 12px;">\u25BC</span>
  `,n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#f7f9fa"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="white"}),n.addEventListener("click",r=>{r.stopPropagation(),K(e)}),e.innerHTML="",e.appendChild(n),e.setAttribute("data-ai-collapsed","true"),e.style.display="block"}function K(e){if(!e.hasAttribute("data-ai-collapsed"))return;let t=N(e);t&&window.slopBlockRemoveFromCollapsed&&window.slopBlockRemoveFromCollapsed(t);let o=e.getAttribute("data-ai-original-content");o&&(e.innerHTML=o),e.querySelectorAll(".ai-hide-header").forEach(a=>a.remove());let r=document.createElement("div");r.className="ai-hide-header",r.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 6px 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
  `,r.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">\u{1F916} hide ai tweet</span>
    <span style="color: #657786; font-size: 12px;">\u25B2</span>
  `,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#f7f9fa"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="white"}),r.addEventListener("click",a=>{a.stopPropagation(),x(e)}),e.insertBefore(r,e.firstChild),e.removeAttribute("data-ai-collapsed"),e.removeAttribute("data-ai-original-content")}var W,H=v(()=>{"use strict";W={totalTweets:0,textExtracted:0,slopDetected:0}});async function O(e){var c,p,u;if(e.length===0)return[];let t,o;try{if(t=await b(s.GROQ_API_KEY,k[s.GROQ_API_KEY]),console.log("SlopBlock: API key status:",t?`Found (${t.length} chars, starts with: ${t.substring(0,10)}...)`:"NOT FOUND"),!t)return console.warn("SlopBlock: No API key set \u2013 skipping remote analysis"),null;if(!t.startsWith("gsk_"))return console.error('SlopBlock: Invalid API key format - Groq keys should start with "gsk_"'),null;o=await b(s.SYSTEM_PROMPT,k[s.SYSTEM_PROMPT])}catch{return console.warn("SlopBlock: Extension context invalidated, skipping analysis"),null}let n=`Analyze these ${e.length} tweets and identify which are AI-generated motivational slop, engagement bait, or generic inspirational content. Return ONLY a JSON object with format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]}

Tweets:
${e.map((i,g)=>`${g}: ${i}`).join(`

`)}`,a={model:"meta-llama/llama-4-maverick-17b-128e-instruct",temperature:.1,max_tokens:1e3,messages:[{role:"system",content:o+`

IMPORTANT: You must respond with ONLY valid JSON in the exact format specified. No additional text, explanations, or formatting.`},{role:"user",content:n}],response_format:{type:"json_object"}};try{console.log("SlopBlock: Making Groq API request...");let i=await fetch(V,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let f=await i.text();return console.error("SlopBlock: HTTP error",i.status,f),i.status===401&&console.error("SlopBlock: API key is invalid. Please check your Groq API key in extension settings."),null}let g=await i.text();if(!g.trim())return console.error("SlopBlock: Empty response from API"),null;let l;try{l=JSON.parse(g)}catch(f){return console.error("SlopBlock: Failed to parse response JSON:",f),console.error("SlopBlock: Response was:",g),null}let d=(u=(p=(c=l==null?void 0:l.choices)==null?void 0:c[0])==null?void 0:p.message)==null?void 0:u.content;if(!d)return console.error("SlopBlock: No content in response data:",l),null;let h;try{h=JSON.parse(d)}catch(f){console.error("SlopBlock: Failed to parse AI response JSON:",f),console.error("SlopBlock: AI content was:",d);try{let E=d.match(/\{[\s\S]*\}/);if(E)console.log("SlopBlock: Attempting to extract JSON from text..."),h=JSON.parse(E[0]),console.log("SlopBlock: Successfully extracted JSON from text");else return console.error("SlopBlock: No JSON found in response"),null}catch(E){return console.error("SlopBlock: Failed to extract JSON from text:",E),null}}return!h.results||!Array.isArray(h.results)?(console.error("SlopBlock: Invalid response format - missing results array"),null):(console.log("SlopBlock: Successfully parsed Groq response"),h.results)}catch(i){return console.error("SlopBlock: Network/parse error",i),null}}var V,P=v(()=>{"use strict";C();V="https://api.groq.com/openai/v1/chat/completions"});var ce=U(()=>{C();H();P();console.log("SlopBlock: Content script loaded");var D=200,F=10,R=15,S=[],m=[],w=[],q=new Map,y=!1,T=null;async function Q(){S=await A(s.PROCESSED_TWEET_IDS,[])}async function Z(){await L(s.PROCESSED_TWEET_IDS,S)}async function X(){m=await A(s.COLLAPSED_TWEET_IDS,[]),console.log("SlopBlock: Loaded",m.length,"collapsed tweets")}async function $(){await L(s.COLLAPSED_TWEET_IDS,m)}function ee(e){var t;m.includes(e)||(m.push(e),m.length>D&&m.splice(0,F),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&$())}function te(e){var t;S.push(e),S.length>D&&S.splice(0,F),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&Z()}async function oe(e){if(e.length===0)return new Set;let t=e.map(o=>o.text);console.log("SlopBlock: Analyzing",e.length,"tweets");try{let o=await O(t);if(console.log("SlopBlock: Analysis results:",o),!o)return console.log("SlopBlock: No API results"),new Set;let n=new Set;return o.forEach((r,a)=>{if(r.isSlop&&a<e.length){let c=e[a].id;n.add(c),console.log("SlopBlock: Flagged tweet",c)}}),n}catch(o){return console.error("SlopBlock: Analysis error:",o),new Set}}function re(e){e.forEach(t=>{let o=q.get(t);o&&(x(o),ee(t),console.log("SlopBlock: Collapsed tweet",t))})}async function ne(){if(w.length<R)return;let e=w.splice(0,R),t=await oe(e);re(t)}function I(e){if(!y)return;let t=_(e);if(!t)return;let{id:o,text:n}=t;if(o){if(q.set(o,e),m.includes(o)){e.hasAttribute("data-ai-collapsed")||(x(e),console.log("SlopBlock: Re-collapsed tweet",o));return}S.includes(o)||(console.log("SlopBlock: Processing tweet",o,n.substring(0,50)+"..."),te(o),w.push({id:o,text:n,element:e}),ne())}}function se(){if(!y)return;let e=B();console.log("SlopBlock: Initial scan found",e.length,"tweets"),e.forEach(t=>I(t))}function ae(){T||(console.log("SlopBlock: Starting mutation observer"),T=new MutationObserver(e=>{y&&e.forEach(t=>{t.addedNodes.forEach(o=>{var n;if(o.nodeType===Node.ELEMENT_NODE){let r=o;r.matches('[data-testid="tweet"]')?I(r):(n=r.querySelectorAll)==null||n.call(r,'[data-testid="tweet"]').forEach(a=>I(a))}})})}),T.observe(document.body,{childList:!0,subtree:!0}))}function ie(){T&&(console.log("SlopBlock: Stopping mutation observer"),T.disconnect(),T=null)}function le(e){var o;let t=m.indexOf(e);t!==-1&&(m.splice(t,1),(o=chrome==null?void 0:chrome.runtime)!=null&&o.id&&$())}async function z(){let e=await b(s.SLOP_BLOCK_ENABLED,!1);console.log("SlopBlock: Extension state changed to:",e?"ENABLED":"DISABLED"),e&&!y?(y=!0,window.slopBlockRemoveFromCollapsed=le,ae(),se()):!e&&y&&(y=!1,window.slopBlockRemoveFromCollapsed=void 0,ie(),w.length=0)}chrome.runtime.onMessage.addListener(e=>{e.action==="stateChanged"&&(console.log("SlopBlock: Received state change message"),z())});(async()=>(console.log("SlopBlock: Initializing extension"),await Q(),await X(),await z(),console.log("SlopBlock: Initialization complete")))()});ce();})();
