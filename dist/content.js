"use strict";(()=>{var b=!1;function M(e){b=e}function C(e){let o=[];return e.querySelectorAll('[data-testid="tweet"]').forEach(n=>{let r=z(n);r&&o.push(r)}),o}function P(e){if(!b)return;console.log("=== TWEET DOM ANALYSIS ==="),console.log("Main element:",e),console.log("innerHTML preview:",e.innerHTML.substring(0,300)),['[data-testid="tweetText"]',".css-1jxf684",".css-1qaijid","[lang]",'span[dir="auto"]',"div[lang]",'span:not([class*="icon"]):not([aria-hidden="true"])'].forEach(n=>{var s;let r=e.querySelector(n);(s=r==null?void 0:r.textContent)!=null&&s.trim()?console.log(`\u2713 Selector "${n}":`,r.textContent.substring(0,100)):console.log(`\u2717 Selector "${n}": no content`)});let t=k(e);console.log(`Found ${t.length} text nodes`),t.slice(0,3).forEach((n,r)=>{var s;console.log(`Text node ${r}:`,(s=n.textContent)==null?void 0:s.substring(0,100))})}function z(e){var o;try{P(e);let t=W(e);b&&(console.log("Extracted text length:",t.length),console.log("Extracted text preview:",t.substring(0,150)));let n=w(e,"like"),r=w(e,"retweet"),s=w(e,"reply"),c=!!e.querySelector('[data-testid="icon-verified"]'),a=e.querySelector('[data-testid="User-Name"] a'),p=((o=a==null?void 0:a.textContent)==null?void 0:o.replace("@",""))||"";return{element:e,textContent:t,metadata:{likes:n,retweets:r,replies:s,isVerified:c,username:p}}}catch(t){return console.warn("Failed to extract tweet data:",t),null}}function W(e){var c,a,p,T;let o=e.querySelector('[data-testid="tweetText"]');if((c=o==null?void 0:o.textContent)!=null&&c.trim())return o.textContent.trim();let t=e.querySelectorAll("[lang]");for(let f of Array.from(t)){let i=(a=f.textContent)==null?void 0:a.trim();if(i&&i.length>20&&!i.includes("http")&&!i.includes("@"))return i}let n=[".css-1jxf684",".css-1qaijid",'span[dir="auto"]',"div[lang] span"];for(let f of n){let i=e.querySelector(f),y=(p=i==null?void 0:i.textContent)==null?void 0:p.trim();if(y&&y.length>10)return y}let r=k(e),s="";for(let f of r){let i=(T=f.textContent)==null?void 0:T.trim();i&&i.length>5&&!i.includes("\xB7")&&!i.match(/^\d+[mhs]$/)&&!i.includes("Show this thread")&&!i.includes("Replying to")&&(s+=i+" ")}return s.trim()}function k(e){let o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),t=[],n;for(;n=o.nextNode();){let r=n.parentElement;r&&(r.tagName==="SCRIPT"||r.tagName==="STYLE"||r.hasAttribute("aria-hidden")||r.style.display==="none"||t.push(n))}return t}function w(e,o){var t;try{let n="";switch(o){case"like":n='[data-testid="like"]';break;case"retweet":n='[data-testid="retweet"]';break;case"reply":n='[data-testid="reply"]';break}let r=e.querySelector(n),s=r==null?void 0:r.querySelector('[data-testid$="count"]'),c=((t=s==null?void 0:s.textContent)==null?void 0:t.trim())||"0";return j(c)}catch{return 0}}function j(e){if(!e||e==="0")return 0;let o=e.toLowerCase(),t=parseFloat(o);return o.includes("k")?Math.floor(t*1e3):o.includes("m")?Math.floor(t*1e6):Math.floor(t)||0}function F(e,o){e.classList.remove("slop-blurred","slop-hidden"),o==="blur"?e.classList.add("slop-blurred"):o==="hide"&&e.classList.add("slop-hidden")}function D(e){var c;if(e.querySelector(".slop-replacement"))return;let o=e.querySelector('[data-testid="tweetText"]'),t=o==null?void 0:o.parentElement;if(t||(t=(c=e.querySelector("[lang]"))==null?void 0:c.parentElement),t||(t=e.querySelector('[data-testid="tweet"]')||e),!t){console.warn("Could not find content container for tweet replacement");return}let n=document.createElement("div");n.className="slop-replacement",n.style.cssText=`
    padding: 16px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 12px;
    text-align: center;
    margin: 8px 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  `,n.innerHTML=`
    <div style="color: #6c757d; font-size: 14px; font-weight: 500; margin-bottom: 8px;">
      \u{1F916} AI-generated content hidden
    </div>
    <button class="slop-show-button" style="
      background: #007bff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    " onmouseover="this.style.backgroundColor='#0056b3'" onmouseout="this.style.backgroundColor='#007bff'">
      Show anyway
    </button>
  `;let r=t.innerHTML;n.querySelector(".slop-show-button").addEventListener("click",()=>{t.innerHTML=r,t.style.filter="blur(3px)",t.style.opacity="0.7";let a=document.createElement("button");a.textContent="Hide again",a.style.cssText=`
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      z-index: 1000;
    `,a.addEventListener("click",()=>{t.innerHTML="",t.appendChild(n),t.style.filter="",t.style.opacity=""}),t.style.position="relative",t.appendChild(a)}),t.innerHTML="",t.appendChild(n)}function x(e,o){if(!b)return;let t=e;t.classList.remove("slop-debug-processed","slop-debug-detected"),o?(t.classList.add("slop-debug-detected"),t.style.border="2px solid red",t.style.backgroundColor="rgba(255, 0, 0, 0.1)"):(t.classList.add("slop-debug-processed"),t.style.border="1px dashed green")}function S(e){e.classList.remove("slop-blurred","slop-hidden")}function N(e,o){let t;return function(...n){t||(e.apply(this,n),t=!0,setTimeout(()=>t=!1,o))}}function O(e,o){let t;return function(...n){clearTimeout(t),t=window.setTimeout(()=>e.apply(this,n),o)}}async function A(e,o){try{return(await chrome.storage.sync.get({[e]:o}))[e]}catch(t){return console.error(`Failed to get storage value for key ${e}:`,t),o}}var d={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode"},H={[d.SLOP_BLOCK_ENABLED]:!1,[d.DETECTION_COUNT]:0,[d.USER_WHITELIST]:[],[d.BLUR_MODE]:!0};var V=[/at first.*then.*but eventually/i,/first.*then.*finally/i,/started.*then.*now/i,/people buy from people who:/i,/want to \w+\? here's how/i,/you don't need:.*you need:/i,/here's what \w+ taught me:/i,/\d{3,}.*here's how/i,/\d{3,}.*here's the/i,/\$\d{1,3}k.*in \d+ days/i,/\d+\s*million.*here's/i,/volume wins on \w+/i,/the answer is more/i,/consistency beats perfection/i,/growth is simply.*\d+%.*\d+%/i,/success is \d+%.*\d+%/i,/went from \$?\d+.*to \$?\d+/i,/\d+\s*(downloads|users|followers)/i,/made \$\d+.*in \d+ months/i,/from zero to \$\d+/i,/stop \w+ing everything/i,/stop making excuses/i,/you're overthinking/i,/quit complaining/i,/you can be a \w+ & still:/i,/successful people don't:/i,/millionaires do this:/i,/your future self will thank you/i,/isn't coming to save you/i,/bet on yourself/i],$={maxEmojis:3,maxLineBreaks:6};function B(e,o){return K(e,o).isSlop}function K(e,o){let t=[],n=0;V.forEach((a,p)=>{a.test(e)&&(t.push(`Matched slop pattern ${p+1}`),n+=.4)});let r=(e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/gu)||[]).length,s=(e.match(/\n/g)||[]).length;return r>$.maxEmojis&&(t.push(`Too many emojis: ${r}`),n+=.3),s>$.maxLineBreaks&&(t.push(`Too many line breaks: ${s}`),n+=.3),e.toLowerCase().includes("ai generated")&&(t.push('Contains "AI generated" phrase'),n+=.8),e.toLowerCase().includes("as an ai")&&(t.push("Contains AI self-identification"),n+=.9),o.likes+o.retweets+o.replies===0&&e.length>200&&(t.push("Long tweet with no engagement"),n+=.3),n=Math.min(n,1),{isSlop:n>.3,confidence:n,reasons:t}}function R(e,o){if(!e||!o.length)return!1;let t=e.toLowerCase().replace("@","");return o.some(n=>n.toLowerCase()===t)}var u=null,l=!1,E=!0,m=!1,L=[],g=new Set;async function I(){console.log("Slop Block content script initializing...");try{let e=await chrome.runtime.sendMessage({action:"getState"});e&&(l=e.enabled,E=e.blurMode),L=await A(d.USER_WHITELIST,H[d.USER_WHITELIST]),m=location.hostname==="localhost"||new URLSearchParams(location.search).has("slopDebug")||location.hash.includes("slopDebug"),M(m),console.log(`Slop Block initialized: enabled=${l}, blurMode=${E}, debug=${m}`),l&&_(),h()}catch(e){console.error("Failed to initialize Slop Block:",e)}}function _(){u&&u.disconnect(),u=new MutationObserver(N(e=>{l&&e.forEach(o=>{o.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&q(t)})})},100)),u.observe(document.body,{childList:!0,subtree:!0}),console.log("DOM observer started")}function Y(){u&&(u.disconnect(),u=null),console.log("DOM observer stopped")}var h=O(()=>{l&&(console.log("Processing existing tweets..."),q(document.body))},200);function q(e){C(e).forEach(t=>G(t))}function G(e){if(!g.has(e.element))try{if(m&&console.log("Processing tweet:",{textLength:e.textContent.length,textPreview:e.textContent.substring(0,100),username:e.metadata.username,element:e.element}),e.metadata.username&&R(e.metadata.username,L)){x(e.element,!1),g.add(e.element);return}B(e.textContent,e.metadata)?(console.log("\u{1F6A8} Slop detected:",{text:e.textContent.substring(0,100)+"...",username:e.metadata.username,engagement:{likes:e.metadata.likes,retweets:e.metadata.retweets,replies:e.metadata.replies}}),E?F(e.element,"blur"):D(e.element),x(e.element,!0),chrome.runtime.sendMessage({action:"updateCount",count:1}).catch(t=>console.log("Background script not ready:",t))):(S(e.element),x(e.element,!1)),g.add(e.element)}catch(o){console.error("Error processing tweet:",o),m&&(console.error("Tweet element:",e.element),console.error("Tweet text:",e.textContent))}}function v(){g.forEach(e=>{S(e)}),g.clear(),console.log("All tweet effects cleared")}chrome.runtime.onMessage.addListener((e,o,t)=>{switch(console.log("Content script received message:",e),e.action){case"toggleSlop":l=e.enabled,console.log(`Slop Block ${l?"enabled":"disabled"}`),l?(_(),h()):(Y(),v());break;case"updateSettings":e.blurMode!==void 0&&(E=e.blurMode,l&&(v(),h())),e.whitelist!==void 0&&(L=e.whitelist,l&&(v(),h()));break;default:console.warn("Unknown message action:",e.action)}return t({success:!0}),!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();var U=location.href;new MutationObserver(()=>{location.href!==U&&(U=location.href,console.log("Page navigation detected, reinitializing..."),g.clear(),setTimeout(()=>{l&&h()},1e3))}).observe(document,{subtree:!0,childList:!0});console.log("Slop Block content script loaded");})();
