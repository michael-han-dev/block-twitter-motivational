"use strict";(()=>{var c=!1;function O(e){c=e}function A(e){let o=[],t=e.querySelectorAll('[data-testid="tweet"]');return c&&console.log(`\u{1F50D} findTweetElements: Found ${t.length} tweet containers in node`),t.forEach((n,s)=>{let i=V(n);i?(o.push(i),c&&console.log(`\u2705 Tweet ${s+1} extracted successfully`)):c&&console.log(`\u274C Tweet ${s+1} failed extraction`)}),o}function W(e){if(!c)return;console.log("=== TWEET DOM ANALYSIS ==="),console.log("Main element:",e),console.log("innerHTML preview:",e.innerHTML.substring(0,300)),['[data-testid="tweetText"]',".css-1jxf684",".css-1qaijid","[lang]",'span[dir="auto"]',"div[lang]",'span:not([class*="icon"]):not([aria-hidden="true"])'].forEach(n=>{var i;let s=e.querySelector(n);(i=s==null?void 0:s.textContent)!=null&&i.trim()?console.log(`\u2713 Selector "${n}":`,s.textContent.substring(0,100)):console.log(`\u2717 Selector "${n}": no content`)});let t=$(e);console.log(`Found ${t.length} text nodes`),t.slice(0,3).forEach((n,s)=>{var i;console.log(`Text node ${s}:`,(i=n.textContent)==null?void 0:i.substring(0,100))})}function V(e){var o;try{W(e);let t=z(e);c&&(console.log("Extracted text length:",t.length),console.log("Extracted text preview:",t.substring(0,150)));let n=M(e,"like"),s=M(e,"retweet"),i=M(e,"reply"),d=!!e.querySelector('[data-testid="icon-verified"]'),u=e.querySelector('[data-testid="User-Name"] a'),h=((o=u==null?void 0:u.textContent)==null?void 0:o.replace("@",""))||"";return{element:e,textContent:t,metadata:{likes:n,retweets:s,replies:i,isVerified:d,username:h}}}catch(t){return console.warn("Failed to extract tweet data:",t),null}}function z(e){var u,h,S,k;let o=e.querySelector('[data-testid="tweetText"]');if((u=o==null?void 0:o.textContent)!=null&&u.trim())return c&&console.log('\u{1F4DD} Text extracted via primary selector [data-testid="tweetText"]'),o.textContent.trim();let t=['[data-testid="tweetText"] span','div[data-testid="tweetText"]','[lang] span[dir="ltr"]','[lang] span[dir="auto"]'];for(let E of t){let r=e.querySelector(E),v=(h=r==null?void 0:r.textContent)==null?void 0:h.trim();if(v&&v.length>10)return c&&console.log(`\u{1F4DD} Text extracted via selector: ${E}`),v}let n=e.querySelectorAll("[lang]");for(let E of Array.from(n)){let r=(S=E.textContent)==null?void 0:S.trim();if(r&&r.length>20&&!r.includes("http")&&!r.includes("@")&&!r.includes("\xB7")&&!r.match(/^\d+[mhsd]$/))return c&&console.log("\u{1F4DD} Text extracted via language-tagged element"),r}let s=$(e),i="";for(let E of s){let r=(k=E.textContent)==null?void 0:k.trim();r&&r.length>5&&!r.includes("\xB7")&&!r.match(/^\d+[mhs]$/)&&!r.includes("Show this thread")&&!r.includes("Replying to")&&!r.includes("Translate")&&!r.includes("View post analytics")&&(i+=r+" ")}let d=i.trim();return c&&console.log(`\u{1F4DD} Text extraction result: "${d.substring(0,100)}..." (length: ${d.length})`),d}function $(e){let o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),t=[],n;for(;n=o.nextNode();){let s=n.parentElement;s&&(s.tagName==="SCRIPT"||s.tagName==="STYLE"||s.hasAttribute("aria-hidden")||s.style.display==="none"||t.push(n))}return t}function M(e,o){var t;try{let n="";switch(o){case"like":n='[data-testid="like"]';break;case"retweet":n='[data-testid="retweet"]';break;case"reply":n='[data-testid="reply"]';break}let s=e.querySelector(n),i=s==null?void 0:s.querySelector('[data-testid$="count"]'),d=((t=i==null?void 0:i.textContent)==null?void 0:t.trim())||"0";return K(d)}catch{return 0}}function K(e){if(!e||e==="0")return 0;let o=e.toLowerCase(),t=parseFloat(o);return o.includes("k")?Math.floor(t*1e3):o.includes("m")?Math.floor(t*1e6):Math.floor(t)||0}function B(e){if(e.hasAttribute("data-slop-collapsed"))return;e.setAttribute("data-original-content",e.innerHTML),e.setAttribute("data-slop-collapsed","true");let o=document.createElement("div");o.className="slop-collapsed",o.innerHTML=`
    <div class="slop-collapsed-header">
      <span class="slop-collapsed-text">AI generated content detected</span>
      <span class="slop-expand-icon">\u25BC</span>
    </div>
  `,o.addEventListener("click",t=>{t.stopPropagation(),j(e)}),e.innerHTML="",e.appendChild(o),e.classList.add("slop-tweet-collapsed")}function j(e){if(!e.hasAttribute("data-slop-collapsed"))return;let o=e.getAttribute("data-original-content");o&&(e.innerHTML=o);let t=document.createElement("div");t.className="slop-collapse-header",t.innerHTML=`
    <div class="slop-collapse-button">
      <span class="slop-collapse-text">Hide AI content</span>
      <span class="slop-collapse-icon">\u25B2</span>
    </div>
  `,t.addEventListener("click",n=>{n.stopPropagation(),B(e)}),e.insertBefore(t,e.firstChild),e.classList.remove("slop-tweet-collapsed"),e.classList.add("slop-tweet-expanded")}function N(e,o){B(e)}function w(e,o){if(!c)return;let t=e;t.classList.remove("slop-debug-processed","slop-debug-detected"),o?(t.classList.add("slop-debug-detected"),t.style.border="2px solid red",t.style.backgroundColor="rgba(255, 0, 0, 0.1)"):(t.classList.add("slop-debug-processed"),t.style.border="1px dashed green")}function C(e){if(e.hasAttribute("data-slop-collapsed")){let t=e.getAttribute("data-original-content");t&&(e.innerHTML=t),e.removeAttribute("data-original-content"),e.removeAttribute("data-slop-collapsed")}e.classList.remove("slop-blurred","slop-hidden","slop-tweet-collapsed","slop-tweet-expanded"),e.querySelectorAll(".slop-collapse-header").forEach(t=>t.remove())}function H(e,o){let t;return function(...n){clearTimeout(t),t=window.setTimeout(()=>e.apply(this,n),o)}}async function y(e,o){try{return(await chrome.storage.sync.get({[e]:o}))[e]}catch(t){return console.error(`Failed to get storage value for key ${e}:`,t),o}}var l={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",USER_WHITELIST:"userWhitelist",BLUR_MODE:"blurMode"},L={[l.SLOP_BLOCK_ENABLED]:!1,[l.DETECTION_COUNT]:0,[l.USER_WHITELIST]:[],[l.BLUR_MODE]:!0};var Y=[/at first.*then.*but eventually/i,/first.*then.*finally/i,/started.*then.*now/i,/people buy from people who:/i,/want to \w+\? here's how/i,/you don't need:.*you need:/i,/here's what \w+ taught me:/i,/\d{3,}.*here's how/i,/\d{3,}.*here's the/i,/\$\d{1,3}k.*in \d+ days/i,/\d+\s*million.*here's/i,/volume wins on \w+/i,/the answer is more/i,/consistency beats perfection/i,/growth is simply.*\d+%.*\d+%/i,/success is \d+%.*\d+%/i,/went from \$?\d+.*to \$?\d+/i,/\d+\s*(downloads|users|followers)/i,/made \$\d+.*in \d+ months/i,/from zero to \$\d+/i,/stop \w+ing everything/i,/stop making excuses/i,/you're overthinking/i,/quit complaining/i,/you can be a \w+ & still:/i,/successful people don't:/i,/millionaires do this:/i,/your future self will thank you/i,/isn't coming to save you/i,/bet on yourself/i],_={maxEmojis:3,maxLineBreaks:6};function F(e,o){return G(e,o).isSlop}function G(e,o){let t=[],n=0;Y.forEach((u,h)=>{u.test(e)&&(t.push(`Matched slop pattern ${h+1}`),n+=.4)});let s=(e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/gu)||[]).length,i=(e.match(/\n/g)||[]).length;return s>_.maxEmojis&&(t.push(`Too many emojis: ${s}`),n+=.3),i>_.maxLineBreaks&&(t.push(`Too many line breaks: ${i}`),n+=.3),e.toLowerCase().includes("ai generated")&&(t.push('Contains "AI generated" phrase'),n+=.8),e.toLowerCase().includes("as an ai")&&(t.push("Contains AI self-identification"),n+=.9),o.likes+o.retweets+o.replies===0&&e.length>200&&(t.push("Long tweet with no engagement"),n+=.3),n=Math.min(n,1),{isSlop:n>.3,confidence:n,reasons:t}}function R(e,o){if(!e||!o.length)return!1;let t=e.toLowerCase().replace("@","");return o.some(n=>n.toLowerCase()===t)}var p=null,a=!1,m=!0,T=!1,x=[],f=new Set;chrome.storage.onChanged.addListener(async(e,o)=>{if(console.log("\u{1F504} Storage change detected:",{area:o,changes:e}),o==="sync"){if(e[l.SLOP_BLOCK_ENABLED]){let t=e[l.SLOP_BLOCK_ENABLED].oldValue,n=e[l.SLOP_BLOCK_ENABLED].newValue;console.log(`\u{1F4F1} Toggle state change: ${t} \u2192 ${n}`),n!==a&&(a=n,console.log(`\u2705 Extension ${a?"ENABLED":"DISABLED"} via storage change`),a?(D(),g()):(U(),b()))}if(e[l.BLUR_MODE]){let t=e[l.BLUR_MODE].newValue;console.log(`\u{1F3A8} Blur mode change: ${m} \u2192 ${t}`),t!==m&&(m=t,a&&(b(),g()))}if(e[l.USER_WHITELIST]){let t=e[l.USER_WHITELIST].newValue;console.log("\u{1F4DD} Whitelist change:",t),x=t,a&&(b(),g())}}});async function I(){console.log("\u{1F680} Slop Block content script initializing...");try{console.log("\u{1F4D6} Reading initial storage values..."),a=await y(l.SLOP_BLOCK_ENABLED,L[l.SLOP_BLOCK_ENABLED]),m=await y(l.BLUR_MODE,L[l.BLUR_MODE]),x=await y(l.USER_WHITELIST,L[l.USER_WHITELIST]),console.log("\u{1F4CA} Initial state:",{isEnabled:a,blurMode:m,whitelistLength:x.length}),T=location.hostname==="localhost"||new URLSearchParams(location.search).has("slopDebug")||location.hash==="#slopDebug",O(T),T&&console.log("\u{1F527} DEBUG MODE ENABLED - Verbose logging active"),console.log(`\u2705 Slop Block initialized: enabled=${a}, blurMode=${m}, debug=${T}`),a?(console.log("\u{1F440} Starting DOM observation..."),D(),console.log("\u{1F50D} Processing existing tweets..."),g()):console.log("\u{1F634} Extension disabled - skipping DOM observation")}catch(e){console.error("\u274C Failed to initialize Slop Block:",e)}}function D(){p&&p.disconnect();let e=null,o=[];p=new MutationObserver(t=>{if(!a){console.log("\u26A0\uFE0F Observer triggered but extension disabled");return}t.forEach(n=>{n.addedNodes.forEach(s=>{s.nodeType===Node.ELEMENT_NODE&&o.push(s)})}),e&&clearTimeout(e),e=setTimeout(()=>{o.length>0&&(console.log(`\u{1F504} Batch processing ${o.length} DOM changes`),o.forEach(n=>q(n)),o=[])},200)}),p.observe(document.body,{childList:!0,subtree:!0}),console.log("\u{1F441}\uFE0F DOM observer started with batching")}function U(){p&&(p.disconnect(),p=null),console.log("DOM observer stopped")}var g=H(()=>{if(!a){console.log("\u26A0\uFE0F processExistingTweets called but extension disabled");return}(()=>{console.log("\u{1F50D} Checking for existing tweets...");let o=performance.now(),t=document.querySelectorAll('[data-testid="tweet"]').length;if(console.log(`\u{1F4CA} Found ${t} tweet elements in DOM`),t>0){q(document.body);let n=performance.now();console.log(`\u23F1\uFE0F Tweet processing completed in ${(n-o).toFixed(2)}ms`)}else console.log("\u23F3 No tweets found yet, will retry when DOM changes")})()},300);function q(e){let o=A(e);T&&(console.log(`\u{1F426} Found ${o.length} tweet elements`),o.length===0&&(console.log("\u{1F4C4} No tweets found - checking selectors on current page"),['[data-testid="tweet"]','article[data-testid="tweet"]','[data-testid="tweetText"]'].forEach(n=>{let s=e.querySelectorAll(n);console.log(`\u{1F3AF} Selector "${n}": ${s.length} elements`)}))),o.forEach((t,n)=>{T&&console.log(`\u{1F504} Processing tweet ${n+1}/${o.length}`),X(t)})}function X(e){if(f.has(e.element)){console.log("\u23ED\uFE0F Tweet already processed, skipping");return}try{if(console.log("\u{1F4DD} Tweet details:",{textLength:e.textContent.length,textPreview:e.textContent.substring(0,50)+(e.textContent.length>50?"...":""),username:e.metadata.username,hasElement:!!e.element}),e.metadata.username&&R(e.metadata.username,x)){console.log(`\u2705 User "${e.metadata.username}" is whitelisted, skipping`),w(e.element,!1),f.add(e.element);return}console.log("\u{1F916} Running slop detection...");let o=F(e.textContent,e.metadata);console.log(`\u{1F3AF} Slop detection result: ${o?"SLOP DETECTED":"NOT SLOP"}`),o?(console.log("\u{1F6A8} SLOP DETECTED - Applying effects:",{text:e.textContent.substring(0,100)+"...",username:e.metadata.username,engagement:{likes:e.metadata.likes,retweets:e.metadata.retweets,replies:e.metadata.replies}}),console.log("\u{1F4E6} Applying collapse effect"),N(e.element,"hide"),w(e.element,!0),Q({action:"updateCount",count:1})):(console.log("\u2705 Tweet is not slop, removing any effects"),C(e.element),w(e.element,!1)),f.add(e.element),console.log(`\u{1F4CA} Total processed tweets: ${f.size}`)}catch(o){console.error("\u274C Error processing tweet:",o),console.error("\u{1F41B} Tweet data:",{element:e.element,text:e.textContent})}}function b(){f.forEach(e=>{C(e)}),f.clear(),console.log("All tweet effects cleared")}function J(){try{return!!(chrome.runtime&&chrome.runtime.id)}catch{return!1}}function Q(e){if(!J()){console.log("\u26A0\uFE0F Extension context invalid, skipping runtime message");return}try{chrome.runtime.sendMessage(e).catch(()=>{})}catch{}}chrome.runtime.onMessage.addListener((e,o,t)=>{switch(console.log("Content script received message:",e),e.action){case"toggleSlop":a=e.enabled,console.log(`\u2705 Extension ${a?"ENABLED":"DISABLED"} via message`),a?(D(),g()):(U(),b());break;case"updateSettings":e.blurMode!==void 0&&(m=e.blurMode,a&&(b(),g())),e.whitelist!==void 0&&(x=e.whitelist,a&&(b(),g()));break;default:console.warn("Unknown message action:",e.action)}return t({success:!0}),!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();var P=location.href;new MutationObserver(()=>{location.href!==P&&(P=location.href,console.log("Page navigation detected, reinitializing..."),f.clear(),setTimeout(()=>{a&&g()},1e3))}).observe(document,{subtree:!0,childList:!0});console.log("Slop Block content script loaded");})();
