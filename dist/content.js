"use strict";(()=>{var O=(e,t)=>()=>(e&&(t=e(e=0)),t);var Y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);async function E(e,t){try{return(await chrome.storage.sync.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get storage value for key ${e}:`,o),t}}async function b(e,t){try{return(await chrome.storage.local.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get local storage value for key ${e}:`,o),t}}async function B(e,t){try{await chrome.storage.local.set({[e]:t})}catch(o){if(o instanceof Error&&o.message.includes("Extension context invalidated")){console.warn(`Extension context invalidated - skipping storage save for ${e}`);return}console.error(`Failed to set local storage value for key ${e}:`,o)}}var a,S,L=O(()=>{"use strict";a={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",BLUR_MODE:"blurMode",GROQ_API_KEY:"groqApiKey",SYSTEM_PROMPT:"systemPrompt",PROCESSED_TWEET_IDS:"processedTweetIds",COLLAPSED_TWEET_IDS:"collapsedTweetIds",BLOCKED_KEYWORDS:"blockedKeywords"},S={[a.SLOP_BLOCK_ENABLED]:!1,[a.DETECTION_COUNT]:0,[a.BLUR_MODE]:!0,[a.GROQ_API_KEY]:"",[a.SYSTEM_PROMPT]:`You are an expert at detecting AI-generated motivational slop, engagement bait, and generic inspirational content on social media. Analyze each tweet and classify it as slop or genuine content. SLOP INDICATORS: motivational clich\xE9s such as \u201Cmindset is everything,\u201D \u201Cfollow your dreams,\u201D or \u201Chustle harder\u201D; money or business schemes promising \u201C$10k/month,\u201D \u201Cpassive income,\u201D or \u201Cfinancial freedom\u201D; generic advice patterns like \u201Chere\u2019s what I learned,\u201D \u201CX things nobody tells you,\u201D or \u201Cstop doing this, start doing this\u201D; engagement bait phrases such as \u201Cunpopular opinion,\u201D \u201Clet that sink in,\u201D or \u201Cthread \u{1F9F5}\u201D; AI-like structures including numbered or bullet lists, formulaic advice, or excessive emojis; buzzwords like entrepreneur, transformation, breakthrough, optimize, or unlock potential; direct sales pitches such as \u201CDM me,\u201D \u201Clink in bio,\u201D \u201Climited time,\u201D or \u201Cexclusive access.\u201D Additional red flags: any presence of the Unicode em dash (U+2014) instantly marks the tweet as slop with confidence 1.0; dramatic one-line paragraphs split for emphasis; repetitive rhetorical questions; exaggerated claims about politics, business deals, or overnight success; imperative mini-sentences (\u201CGo gym.\u201D, \u201CKeep shipping.\u201D). If two or more indicators appear, classify as slop with high confidence; otherwise judge contextually. 

Important! You must return JSON format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]} where id matches tweet position (0-10).`,[a.PROCESSED_TWEET_IDS]:[],[a.COLLAPSED_TWEET_IDS]:[],[a.BLOCKED_KEYWORDS]:[]}});function I(){return Array.from(document.querySelectorAll('[data-testid="tweet"]')).filter(e=>{let t=e.closest("article");return t&&!t.hasAttribute("data-slop-processed")})}function U(e){let t=['[data-testid="tweetPhoto"]','[data-testid="videoPlayer"]','[data-testid="tweetVideo"]','[data-testid="videoComponent"]','[data-testid="card.wrapper"]','[data-testid="tweetGif"]','[data-testid="gif"]','[data-testid="poll"]','[data-testid="quoteTweet"]','img[src*="pbs.twimg.com"]','img[src*="media"]','[data-testid="attachments"]'];for(let o of t)if(e.querySelector(o))return!0;return!1}function M(e){let t=e.querySelectorAll('a[href*="/status/"]');for(let o of Array.from(t)){let n=o.href.match(/\/status\/(\d+)/);if(n&&n[1])return n[1]}return null}function z(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return"h"+Math.abs(t)}async function P(e){var o;let t;try{if(t=await E(a.BLOCKED_KEYWORDS,S[a.BLOCKED_KEYWORDS]),U(e)&&t.length===0)return null;let r=M(e),n=J(e);if(!n)return null;let s=e.querySelector('[data-testid="User-Name"]'),c=((o=s==null?void 0:s.textContent)==null?void 0:o.trim())||"unknown";return{id:r||z(n),text:n,username:c,element:e,timestamp:Date.now()}}catch(r){return console.error("Error extracting tweet data:",r),null}}function J(e){var g,x;let t="",r=e.querySelector('[data-testid="tweetText"]');if((g=r==null?void 0:r.textContent)!=null&&g.trim())return t=r.textContent.trim(),t;let n=["[lang] span",".css-901oao span",'[dir="auto"] span'];for(let i of n){let l=e.querySelectorAll(i),m=Array.from(l).map(f=>{var h;return(h=f.textContent)==null?void 0:h.trim()}).filter(f=>f&&f.length>0);if(m.length>0&&(t=m.join(" ").trim(),t.length>10))return t}let s=e.querySelectorAll('[lang]:not([lang=""])');for(let i of Array.from(s)){let l=(x=i.textContent)==null?void 0:x.trim();l&&l.length>t.length&&(t=l)}if(t.trim().length>10)return t.trim();let c=e.querySelector('[data-testid="tweet"]')||e,d=G(c).map(i=>{var l;return(l=i.textContent)==null?void 0:l.trim()}).filter(i=>i!==void 0&&i.length>3).filter(i=>!j(i));return d.length>0?(t=d.join(" ").trim(),t):""}function G(e){let t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:n=>{var d;let s=n.parentElement;if(!s)return NodeFilter.FILTER_REJECT;let c=s.tagName.toLowerCase();if(["script","style","svg"].includes(c))return NodeFilter.FILTER_REJECT;let p=(d=n.textContent)==null?void 0:d.trim();return!p||p.length<3?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),r;for(;r=o.nextNode();)t.push(r);return t}function j(e){return[/^\d+[hms]$/,/^Â·$/,/^@/,/^Show this thread$/,/^Replying to/,/^Quote Tweet$/,/^Retweet$/,/^\d+$/,/^Show replies$/,/^More$/].some(o=>o.test(e.trim()))}function A(e){var c,p,d;if(e.hasAttribute("data-ai-collapsed"))return;e.querySelectorAll(".ai-tweet-bar").forEach(g=>g.remove());let o=e.innerHTML;e.setAttribute("data-ai-original-content",o);let n=((d=(((p=(c=e.querySelector('[data-testid="User-Name"]'))==null?void 0:c.textContent)==null?void 0:p.trim())||"unknown").match(/@\w+/))==null?void 0:d[0])||"unknown",s=document.createElement("div");s.className="ai-tweet-bar",s.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 8px 12px;
    margin: 4px 0;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 20px;
  `,s.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">${n}: ai tweet hidden</span>
    <span style="color: #657786; font-size: 12px;">\u25BC</span>
  `,s.addEventListener("mouseenter",()=>{s.style.backgroundColor="#f7f9fa"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="white"}),s.addEventListener("click",g=>{g.stopPropagation(),V(e)}),e.innerHTML="",e.appendChild(s),e.setAttribute("data-ai-collapsed","true"),e.style.display="block"}function V(e){if(!e.hasAttribute("data-ai-collapsed"))return;let t=M(e);t&&window.slopBlockRemoveFromCollapsed&&window.slopBlockRemoveFromCollapsed(t);let o=e.getAttribute("data-ai-original-content");o&&(e.innerHTML=o),e.querySelectorAll(".ai-hide-header").forEach(s=>s.remove());let n=document.createElement("div");n.className="ai-hide-header",n.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 6px 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
  `,n.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">unhide</span>
    <span style="color: #657786; font-size: 12px;">\u25B2</span>
  `,n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#f7f9fa"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="white"}),n.addEventListener("click",s=>{s.stopPropagation(),A(e)}),e.insertBefore(n,e.firstChild),e.removeAttribute("data-ai-collapsed"),e.removeAttribute("data-ai-original-content")}var N=O(()=>{"use strict";L()});async function D(e){var d,g,x;if(e.length===0)return[];let t,o,r;try{if(t=await b(a.GROQ_API_KEY,S[a.GROQ_API_KEY]),console.log("SlopBlock: API key status:",t?`Found (${t.length} chars, starts with: ${t.substring(0,10)}...)`:"NOT FOUND"),!t)return console.warn("SlopBlock: No API key set \u2013 skipping remote analysis"),null;if(!t.startsWith("gsk_"))return console.error('SlopBlock: Invalid API key format - Groq keys should start with "gsk_"'),null;o=await E(a.SYSTEM_PROMPT,S[a.SYSTEM_PROMPT]),r=await E(a.BLOCKED_KEYWORDS,S[a.BLOCKED_KEYWORDS])}catch{return console.warn("SlopBlock: Extension context invalidated, skipping analysis"),null}let n=r.length>0?`
Additionally, mark a tweet as slop with confidence 1.0 if it contains any of the blocked keywords/phrases \u2014or a recognizable obfuscated form of them\u2014where \u201Crecognizable\u201D means the keyword appears irrespective of case, with or without intervening punctuation, underscores, periods, or whitespace, and with common numeric or symbol substitutions for visually similar letters (for example "@", \u201C0\u201D for \u201Co,\u201D \u201C1\u201D for \u201Cl,\u201D \u201C3\u201D for \u201Ce\u201D). Treat the keyword as present even inside hashtags, @-mentions, or longer handles (e.g. \u201C@trycluely,\u201D \u201Cclu.ely,\u201D \u201Cc1uely,\u201D \u201Cc l u e l y\u201D). Do not flag tweets where the letters form an unrelated English word with a distinct meaning (for example, \u201Cclue\u201D in a detective context does not trigger on \u201Ccluely\u201D): ${r.join(", ")}`:"",s=`Analyze these ${e.length} tweets and identify which are AI-generated motivational slop, engagement bait, or generic inspirational content. Return ONLY a JSON object with format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]}${n}

Tweets:
${e.map((i,l)=>`${l}: ${i}`).join(`

`)}`,p={model:"meta-llama/llama-4-maverick-17b-128e-instruct",temperature:.1,max_tokens:1e3,messages:[{role:"system",content:o},{role:"user",content:s}],response_format:{type:"json_object"}};try{let i=await fetch(Q,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!i.ok){let k=await i.text();return console.error("SlopBlock: HTTP error",i.status,k),i.status===401&&console.error("SlopBlock: API key is invalid. Please check your Groq API key in extension settings."),null}let l=await i.text();if(!l.trim())return console.error("SlopBlock: Empty response from API"),null;let m;try{m=JSON.parse(l)}catch(k){return console.error("SlopBlock: Failed to parse response JSON:",k),console.error("SlopBlock: Response was:",l),null}let f=(x=(g=(d=m==null?void 0:m.choices)==null?void 0:d[0])==null?void 0:g.message)==null?void 0:x.content;if(!f)return console.error("SlopBlock: No content in response data:",m),null;let h;try{h=JSON.parse(f)}catch(k){console.error("SlopBlock: Failed to parse AI response JSON:",k),console.error("SlopBlock: AI content was:",f);try{let v=f.match(/\{[\s\S]*\}/);if(v)console.log("SlopBlock: Attempting to extract JSON from text..."),h=JSON.parse(v[0]),console.log("SlopBlock: Successfully extracted JSON from text");else return console.error("SlopBlock: No JSON found in response"),null}catch(v){return console.error("SlopBlock: Failed to extract JSON from text:",v),null}}return!h.results||!Array.isArray(h.results)?(console.error("SlopBlock: Invalid response format - missing results array"),null):(console.log("SlopBlock: Successfully parsed Groq response"),h.results)}catch(i){return console.error("SlopBlock: Network/parse error",i),null}}var Q,R=O(()=>{"use strict";L();Q="https://api.groq.com/openai/v1/chat/completions"});var de=Y(()=>{L();N();R();console.log("SlopBlock: Content script loaded");var F=200,K=10,H=10,y=[],u=[],C=[],$=new Map,w=!1,T=null;async function X(){y=await b(a.PROCESSED_TWEET_IDS,[])}async function Z(){await B(a.PROCESSED_TWEET_IDS,y)}async function ee(){u=await b(a.COLLAPSED_TWEET_IDS,[]),console.log("SlopBlock: Loaded",u.length,"collapsed tweets")}async function q(){await B(a.COLLAPSED_TWEET_IDS,u)}function te(e){var t;u.includes(e)||(u.push(e),u.length>F&&u.splice(0,K),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&q())}function oe(e){var t;y.push(e),y.length>F&&y.splice(0,K),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&Z()}async function ne(e){if(e.length===0)return new Set;let t=e.map(o=>o.text);console.log("SlopBlock: Analyzing",e.length,"tweets");try{let o=await D(t);if(console.log("SlopBlock: Analysis results:",o),!o)return console.log("SlopBlock: No API results"),new Set;let r=new Set;return o.forEach((n,s)=>{if(n.isSlop&&s<e.length){let c=e[s].id;r.add(c),console.log("SlopBlock: Flagged tweet",c)}}),r}catch(o){return console.error("SlopBlock: Analysis error:",o),new Set}}function re(e){e.forEach(t=>{let o=$.get(t);o&&(A(o),te(t),console.log("SlopBlock: Collapsed tweet",t))})}async function se(){if(C.length<H)return;let e=C.splice(0,H),t=await ne(e);re(t)}async function _(e){let t;if(!w)return;let o=await P(e);if(!o)return;let{id:r,text:n}=o;if(r){if($.set(r,e),u.includes(r)){e.hasAttribute("data-ai-collapsed")||(A(e),console.log("SlopBlock: Re-collapsed tweet",r));return}y.includes(r)||(console.log("SlopBlock: Processing tweet",r,n.substring(0,50)+"..."),oe(r),C.push({id:r,text:n,element:e}),se())}}function ae(){if(!w)return;let e=I();console.log("SlopBlock: Initial scan found",e.length,"tweets"),e.forEach(t=>_(t))}function ie(){T||(console.log("SlopBlock: Starting mutation observer"),T=new MutationObserver(e=>{w&&e.forEach(t=>{t.addedNodes.forEach(o=>{var r;if(o.nodeType===Node.ELEMENT_NODE){let n=o;n.matches('[data-testid="tweet"]')?_(n):(r=n.querySelectorAll)==null||r.call(n,'[data-testid="tweet"]').forEach(s=>_(s))}})})}),T.observe(document.body,{childList:!0,subtree:!0}))}function le(){T&&(console.log("SlopBlock: Stopping mutation observer"),T.disconnect(),T=null)}function ce(e){var o;let t=u.indexOf(e);t!==-1&&(u.splice(t,1),(o=chrome==null?void 0:chrome.runtime)!=null&&o.id&&q())}async function W(){let e=await E(a.SLOP_BLOCK_ENABLED,!1);console.log("SlopBlock: Extension state changed to:",e?"ENABLED":"DISABLED"),e&&!w?(w=!0,window.slopBlockRemoveFromCollapsed=ce,ie(),ae()):!e&&w&&(w=!1,window.slopBlockRemoveFromCollapsed=void 0,le(),C.length=0)}chrome.runtime.onMessage.addListener(e=>{e.action==="stateChanged"&&(console.log("SlopBlock: Received state change message"),W())});(async()=>(console.log("SlopBlock: Initializing extension"),await X(),await ee(),await W(),console.log("SlopBlock: Initialization complete")))()});de();})();
