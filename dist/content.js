"use strict";(()=>{var b=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);async function y(e,t){try{return(await chrome.storage.sync.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get storage value for key ${e}:`,o),t}}async function v(e,t){try{return(await chrome.storage.local.get({[e]:t}))[e]}catch(o){return console.error(`Failed to get local storage value for key ${e}:`,o),t}}async function A(e,t){try{await chrome.storage.local.set({[e]:t})}catch(o){if(o instanceof Error&&o.message.includes("Extension context invalidated")){console.warn(`Extension context invalidated - skipping storage save for ${e}`);return}console.error(`Failed to set local storage value for key ${e}:`,o)}}var s,L,C=b(()=>{"use strict";s={SLOP_BLOCK_ENABLED:"slopBlockEnabled",DETECTION_COUNT:"detectionCount",BLUR_MODE:"blurMode",GROQ_API_KEY:"groqApiKey",SYSTEM_PROMPT:"systemPrompt",PROCESSED_TWEET_IDS:"processedTweetIds",COLLAPSED_TWEET_IDS:"collapsedTweetIds",BLOCKED_KEYWORDS:"blockedKeywords"},L={[s.SLOP_BLOCK_ENABLED]:!1,[s.DETECTION_COUNT]:0,[s.BLUR_MODE]:!0,[s.GROQ_API_KEY]:"",[s.SYSTEM_PROMPT]:`You are an expert at detecting AI-generated motivational slop, engagement bait, and generic inspirational content on social media. Analyze each tweet and classify it as slop or genuine content. SLOP INDICATORS: motivational clich\xE9s such as \u201Cmindset is everything,\u201D \u201Cfollow your dreams,\u201D or \u201Chustle harder\u201D; money or business schemes promising \u201C$10k/month,\u201D \u201Cpassive income,\u201D or \u201Cfinancial freedom\u201D; generic advice patterns like \u201Chere\u2019s what I learned,\u201D \u201CX things nobody tells you,\u201D or \u201Cstop doing this, start doing this\u201D; engagement bait phrases such as \u201Cunpopular opinion,\u201D \u201Clet that sink in,\u201D or \u201Cthread \u{1F9F5}\u201D; AI-like structures including numbered or bullet lists, formulaic advice, or excessive emojis; buzzwords like entrepreneur, transformation, breakthrough, optimize, or unlock potential; direct sales pitches such as \u201CDM me,\u201D \u201Clink in bio,\u201D \u201Climited time,\u201D or \u201Cexclusive access.\u201D Additional red flags: any presence of the Unicode em dash (U+2014) instantly marks the tweet as slop with confidence 1.0; dramatic one-line paragraphs split for emphasis; repetitive rhetorical questions; exaggerated claims about politics, business deals, or overnight success; imperative mini-sentences (\u201CGo gym.\u201D, \u201CKeep shipping.\u201D). If two or more indicators appear, classify as slop with high confidence; otherwise judge contextually. 

Important! You must return JSON format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]} where id matches tweet position (0-10).`,[s.PROCESSED_TWEET_IDS]:[],[s.COLLAPSED_TWEET_IDS]:[],[s.BLOCKED_KEYWORDS]:[]}});function O(){return Array.from(document.querySelectorAll('[data-testid="tweet"]')).filter(e=>{let t=e.closest("article");return t&&!t.hasAttribute("data-slop-processed")})}function W(e){let t=['[data-testid="tweetPhoto"]','[data-testid="videoPlayer"]','[data-testid="tweetVideo"]','[data-testid="videoComponent"]','[data-testid="card.wrapper"]','[data-testid="tweetGif"]','[data-testid="gif"]','[data-testid="poll"]','[data-testid="quoteTweet"]','img[src*="pbs.twimg.com"]','img[src*="media"]','[data-testid="attachments"]'];for(let o of t)if(e.querySelector(o))return!0;return!1}function I(e){let t=e.querySelectorAll('a[href*="/status/"]');for(let o of Array.from(t)){let n=o.href.match(/\/status\/(\d+)/);if(n&&n[1])return n[1]}return null}function U(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return"h"+Math.abs(t)}function _(e){var t;try{if(W(e))return null;let o=I(e),r=z(e);if(!r)return null;let n=e.querySelector('[data-testid="User-Name"]'),a=((t=n==null?void 0:n.textContent)==null?void 0:t.trim())||"unknown";return{id:o||U(r),text:r,username:a,element:e,timestamp:Date.now()}}catch(o){return console.error("Error extracting tweet data:",o),null}}function z(e){var l,f;let t="",r=e.querySelector('[data-testid="tweetText"]');if((l=r==null?void 0:r.textContent)!=null&&l.trim())return t=r.textContent.trim(),t;let n=["[lang] span",".css-901oao span",'[dir="auto"] span'];for(let i of n){let c=e.querySelectorAll(i),m=Array.from(c).map(u=>{var h;return(h=u.textContent)==null?void 0:h.trim()}).filter(u=>u&&u.length>0);if(m.length>0&&(t=m.join(" ").trim(),t.length>10))return t}let a=e.querySelectorAll('[lang]:not([lang=""])');for(let i of Array.from(a)){let c=(f=i.textContent)==null?void 0:f.trim();c&&c.length>t.length&&(t=c)}if(t.trim().length>10)return t.trim();let d=e.querySelector('[data-testid="tweet"]')||e,g=Y(d).map(i=>{var c;return(c=i.textContent)==null?void 0:c.trim()}).filter(i=>i!==void 0&&i.length>3).filter(i=>!J(i));return g.length>0?(t=g.join(" ").trim(),t):""}function Y(e){let t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:n=>{var g;let a=n.parentElement;if(!a)return NodeFilter.FILTER_REJECT;let d=a.tagName.toLowerCase();if(["script","style","svg"].includes(d))return NodeFilter.FILTER_REJECT;let S=(g=n.textContent)==null?void 0:g.trim();return!S||S.length<3?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),r;for(;r=o.nextNode();)t.push(r);return t}function J(e){return[/^\d+[hms]$/,/^Â·$/,/^@/,/^Show this thread$/,/^Replying to/,/^Quote Tweet$/,/^Retweet$/,/^\d+$/,/^Show replies$/,/^More$/].some(o=>o.test(e.trim()))}function x(e){if(e.hasAttribute("data-ai-collapsed"))return;e.querySelectorAll(".ai-tweet-bar").forEach(n=>n.remove());let o=e.innerHTML;e.setAttribute("data-ai-original-content",o);let r=document.createElement("div");r.className="ai-tweet-bar",r.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 8px 12px;
    margin: 4px 0;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 20px;
  `,r.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">ai tweet hidden</span>
    <span style="color: #657786; font-size: 12px;">\u25BC</span>
  `,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#f7f9fa"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="white"}),r.addEventListener("click",n=>{n.stopPropagation(),G(e)}),e.innerHTML="",e.appendChild(r),e.setAttribute("data-ai-collapsed","true"),e.style.display="block"}function G(e){if(!e.hasAttribute("data-ai-collapsed"))return;let t=I(e);t&&window.slopBlockRemoveFromCollapsed&&window.slopBlockRemoveFromCollapsed(t);let o=e.getAttribute("data-ai-original-content");o&&(e.innerHTML=o),e.querySelectorAll(".ai-hide-header").forEach(a=>a.remove());let n=document.createElement("div");n.className="ai-hide-header",n.style.cssText=`
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 6px 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    justify-content: space-between;
  `,n.innerHTML=`
    <span style="color: #657786; font-size: 13px; font-weight: 400;">\u{1F916} hide ai tweet</span>
    <span style="color: #657786; font-size: 12px;">\u25B2</span>
  `,n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#f7f9fa"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="white"}),n.addEventListener("click",a=>{a.stopPropagation(),x(e)}),e.insertBefore(n,e.firstChild),e.removeAttribute("data-ai-collapsed"),e.removeAttribute("data-ai-original-content")}var M=b(()=>{"use strict"});async function N(e){var d,S,g;if(e.length===0)return[];let t,o;try{if(t=await y(s.GROQ_API_KEY,L[s.GROQ_API_KEY]),console.log("SlopBlock: API key status:",t?`Found (${t.length} chars, starts with: ${t.substring(0,10)}...)`:"NOT FOUND"),!t)return console.warn("SlopBlock: No API key set \u2013 skipping remote analysis"),null;if(!t.startsWith("gsk_"))return console.error('SlopBlock: Invalid API key format - Groq keys should start with "gsk_"'),null;o=await y(s.SYSTEM_PROMPT,L[s.SYSTEM_PROMPT])}catch{return console.warn("SlopBlock: Extension context invalidated, skipping analysis"),null}let r=`Analyze these ${e.length} tweets and identify which are AI-generated motivational slop, engagement bait, or generic inspirational content. Return ONLY a JSON object with format: {"results": [{"id": 0, "isSlop": true/false, "confidence": 0.0-1.0}]}

Tweets:
${e.map((l,f)=>`${f}: ${l}`).join(`

`)}`,a={model:"meta-llama/llama-4-maverick-17b-128e-instruct",temperature:.1,max_tokens:1e3,messages:[{role:"system",content:o},{role:"user",content:r}],response_format:{type:"json_object"}};try{let l=await fetch(j,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){let u=await l.text();return console.error("SlopBlock: HTTP error",l.status,u),l.status===401&&console.error("SlopBlock: API key is invalid. Please check your Groq API key in extension settings."),null}let f=await l.text();if(!f.trim())return console.error("SlopBlock: Empty response from API"),null;let i;try{i=JSON.parse(f)}catch(u){return console.error("SlopBlock: Failed to parse response JSON:",u),console.error("SlopBlock: Response was:",f),null}let c=(g=(S=(d=i==null?void 0:i.choices)==null?void 0:d[0])==null?void 0:S.message)==null?void 0:g.content;if(!c)return console.error("SlopBlock: No content in response data:",i),null;let m;try{m=JSON.parse(c)}catch(u){console.error("SlopBlock: Failed to parse AI response JSON:",u),console.error("SlopBlock: AI content was:",c);try{let h=c.match(/\{[\s\S]*\}/);if(h)console.log("SlopBlock: Attempting to extract JSON from text..."),m=JSON.parse(h[0]),console.log("SlopBlock: Successfully extracted JSON from text");else return console.error("SlopBlock: No JSON found in response"),null}catch(h){return console.error("SlopBlock: Failed to extract JSON from text:",h),null}}return!m.results||!Array.isArray(m.results)?(console.error("SlopBlock: Invalid response format - missing results array"),null):(console.log("SlopBlock: Successfully parsed Groq response"),m.results)}catch(l){return console.error("SlopBlock: Network/parse error",l),null}}var j,P=b(()=>{"use strict";C();j="https://api.groq.com/openai/v1/chat/completions"});var le=K(()=>{C();M();P();console.log("SlopBlock: Content script loaded");var D=200,H=10,R=10,T=[],p=[],k=[],F=new Map,E=!1,w=null;async function V(){T=await v(s.PROCESSED_TWEET_IDS,[])}async function Q(){await A(s.PROCESSED_TWEET_IDS,T)}async function X(){p=await v(s.COLLAPSED_TWEET_IDS,[]),console.log("SlopBlock: Loaded",p.length,"collapsed tweets")}async function q(){await A(s.COLLAPSED_TWEET_IDS,p)}function Z(e){var t;p.includes(e)||(p.push(e),p.length>D&&p.splice(0,H),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&q())}function ee(e){var t;T.push(e),T.length>D&&T.splice(0,H),(t=chrome==null?void 0:chrome.runtime)!=null&&t.id&&Q()}async function te(e){if(e.length===0)return new Set;let t=e.map(o=>o.text);console.log("SlopBlock: Analyzing",e.length,"tweets");try{let o=await N(t);if(console.log("SlopBlock: Analysis results:",o),!o)return console.log("SlopBlock: No API results"),new Set;let r=new Set;return o.forEach((n,a)=>{if(n.isSlop&&a<e.length){let d=e[a].id;r.add(d),console.log("SlopBlock: Flagged tweet",d)}}),r}catch(o){return console.error("SlopBlock: Analysis error:",o),new Set}}function oe(e){e.forEach(t=>{let o=F.get(t);o&&(x(o),Z(t),console.log("SlopBlock: Collapsed tweet",t))})}async function ne(){if(k.length<R)return;let e=k.splice(0,R),t=await te(e);oe(t)}function B(e){if(!E)return;let t=_(e);if(!t)return;let{id:o,text:r}=t;if(o){if(F.set(o,e),p.includes(o)){e.hasAttribute("data-ai-collapsed")||(x(e),console.log("SlopBlock: Re-collapsed tweet",o));return}T.includes(o)||(console.log("SlopBlock: Processing tweet",o,r.substring(0,50)+"..."),ee(o),k.push({id:o,text:r,element:e}),ne())}}function re(){if(!E)return;let e=O();console.log("SlopBlock: Initial scan found",e.length,"tweets"),e.forEach(t=>B(t))}function se(){w||(console.log("SlopBlock: Starting mutation observer"),w=new MutationObserver(e=>{E&&e.forEach(t=>{t.addedNodes.forEach(o=>{var r;if(o.nodeType===Node.ELEMENT_NODE){let n=o;n.matches('[data-testid="tweet"]')?B(n):(r=n.querySelectorAll)==null||r.call(n,'[data-testid="tweet"]').forEach(a=>B(a))}})})}),w.observe(document.body,{childList:!0,subtree:!0}))}function ae(){w&&(console.log("SlopBlock: Stopping mutation observer"),w.disconnect(),w=null)}function ie(e){var o;let t=p.indexOf(e);t!==-1&&(p.splice(t,1),(o=chrome==null?void 0:chrome.runtime)!=null&&o.id&&q())}async function $(){let e=await y(s.SLOP_BLOCK_ENABLED,!1);console.log("SlopBlock: Extension state changed to:",e?"ENABLED":"DISABLED"),e&&!E?(E=!0,window.slopBlockRemoveFromCollapsed=ie,se(),re()):!e&&E&&(E=!1,window.slopBlockRemoveFromCollapsed=void 0,ae(),k.length=0)}chrome.runtime.onMessage.addListener(e=>{e.action==="stateChanged"&&(console.log("SlopBlock: Received state change message"),$())});(async()=>(console.log("SlopBlock: Initializing extension"),await V(),await X(),await $(),console.log("SlopBlock: Initialization complete")))()});le();})();
